var q=Object.defineProperty;var R=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var S=(d,e,o)=>e in d?q(d,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[e]=o,T=(d,e)=>{for(var o in e||(e={}))U.call(e,o)&&S(d,o,e[o]);if(R)for(var o of R(e))G.call(e,o)&&S(d,o,e[o]);return d};var C=(d,e,o)=>new Promise((a,_)=>{var y=r=>{try{m(o.next(r))}catch(l){_(l)}},v=r=>{try{m(o.throw(r))}catch(l){_(l)}},m=r=>r.done?a(r.value):Promise.resolve(r.value).then(y,v);m((o=o.apply(d,e)).next())});import{_ as O,D as u,a9 as P,m as J,n as F,H as n,G as b,Q as i,R as f,F as K,S as W,P as X,r as g,e as Y,o as Z,a7 as x,aw as $,av as k}from"./index-pPDUazPi.js";import ee from"./resourceForm-CIGKoGn4.js";import{B as ae}from"./index-Du6GEIhW.js";const te={name:"resources",components:{resourceForm:ee,BuildLogViewer:ae},setup(d,{emit:e}){const o=g([]),a=g(!1),_=g({}),y=g(!1),v=g(0),m=g([]),r=g(!1),l=g(null),z=g(null),c=g({}),w=Y({type:"CTF",page:1,page_size:10,subject:null,search:null}),B=()=>C(null,null,function*(){const t=yield x.get("/api/admin/ctf/question/type");o.value=t.data}),p=()=>C(null,null,function*(){a.value=!0;try{const t=yield x.get("/api/admin/docker/resource",w);m.value=t.data,v.value=t.total}finally{a.value=!1}}),D=()=>C(null,null,function*(){try{yield x.post("/api/admin/ctf/sync_repo"),k({type:"success",message:"任务提交成功",duration:2e3})}catch(t){k.error("同步失败")}}),V=t=>{w.page_size=t,p()},s=t=>{w.page=t,p()},h=()=>{_.value={},y.value=!0},Q=t=>C(null,null,function*(){var L;try{l.value=t.id,c.value[t.id]=!0;const H=(L=(yield x.post(`/api/admin/docker/resource/${t.id}/build`)).data)==null?void 0:L.task_id;H&&(z.value=H),k({type:"success",message:"任务已提交",duration:2e3}),r.value=!0,yield p()}catch(N){k.error("编译失败")}finally{c.value[t.id]=!1}}),I=t=>{y.value=!0,_.value=T({},t)},M=t=>C(null,null,function*(){try{yield $.confirm("确认要删除该资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield x.delete(`/api/admin/docker/resource/${t.id}`),k({type:"success",message:"删除成功",duration:2e3}),yield p()}catch(L){L!=="cancel"&&k.error("删除失败")}}),A=t=>{y.value=!1,t&&p()},j=()=>{l.value=null},E=t=>{l.value=t.id,r.value=!0};return Z(()=>{p(),B()}),{qType:o,listQuery:w,loading:a,currentRow:_,showResourceForm:y,total:v,listData:m,showLogDialog:r,currentBuildId:l,buildLoadingMap:c,handleLogDialogClosed:j,getList:p,handleSyncRemoteCtfRepo:D,handleSizeChange:V,handleCurrentChange:s,handleCreate:h,buildHandle:Q,editHandle:I,deleteHandle:M,handleAdd:A,viewLogHandle:E}}},ne={class:"main"},oe={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},le={class:"page-r"};function re(d,e,o,a,_,y){const v=u("resource-form"),m=u("el-input"),r=u("el-form-item"),l=u("el-button"),z=u("el-form"),c=u("el-table-column"),w=u("el-tag"),B=u("el-table"),p=u("el-pagination"),D=u("build-log-viewer"),V=P("loading");return F(),J("div",ne,[n(v,{data:a.currentRow,open:a.showResourceForm,onAction:a.handleAdd},null,8,["data","open","onAction"]),n(z,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:i(()=>[n(r,{class:"el-form-item",label:"资源名称"},{default:i(()=>[n(m,{modelValue:a.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=s=>a.listQuery.search=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(r,null,{default:i(()=>[n(l,{style:{margin:"0 5px"},type:"primary",onClick:a.getList},{default:i(()=>[...e[2]||(e[2]=[f("查询",-1)])]),_:1},8,["onClick"]),n(l,{type:"success",onClick:a.handleCreate},{default:i(()=>[...e[3]||(e[3]=[f("添加",-1)])]),_:1},8,["onClick"]),n(l,{type:"warning",onClick:a.handleSyncRemoteCtfRepo},{default:i(()=>[...e[4]||(e[4]=[f("同步仓库资源",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),b("div",oe,[e[9]||(e[9]=b("div",{class:"flex justify-between w-full h-[60px] p-4"},[b("p",{class:"font-bold truncate"},"CTF环境资源")],-1)),b("div",null,[K((F(),W(B,{fit:"","highlight-current-row":"",stripe:"",data:a.listData},{default:i(()=>[n(c,{align:"center",label:"标题",prop:"name",width:"220","class-name":"fnt-12"}),n(c,{align:"center",label:"镜像",prop:"image","class-name":"fnt-12"}),n(c,{align:"center",label:"加载方式",prop:"docker_type_name",width:"180","class-name":"fnt-12"}),n(c,{align:"center",label:"状态",prop:"status_name",width:"120"},{default:i(s=>[n(w,{type:s.row.status===1?"success":"info"},{default:i(()=>[f(X(s.row.status_name),1)]),_:2},1032,["type"])]),_:1}),n(c,{align:"center",label:"添加日期",prop:"created_at",width:"150","class-name":"fnt-12"}),n(c,{align:"center",label:"操作",width:"280"},{default:i(s=>[n(l,{link:"",type:"primary",loading:a.buildLoadingMap[s.row.id],onClick:h=>a.buildHandle(s.row)},{default:i(()=>[...e[5]||(e[5]=[f("编译",-1)])]),_:1},8,["loading","onClick"]),n(l,{link:"",type:"primary",onClick:h=>a.viewLogHandle(s.row)},{default:i(()=>[...e[6]||(e[6]=[f("日志",-1)])]),_:1},8,["onClick"]),n(l,{link:"",type:"primary",onClick:h=>a.editHandle(s.row)},{default:i(()=>[...e[7]||(e[7]=[f("编辑",-1)])]),_:1},8,["onClick"]),n(l,{link:"",type:"danger",onClick:h=>a.deleteHandle(s.row)},{default:i(()=>[...e[8]||(e[8]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[V,a.loading]]),b("div",le,[n(p,{"current-page":a.listQuery.page,"page-size":a.listQuery.page_size,"page-sizes":[10,20,30,50],total:a.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),n(D,{modelValue:a.showLogDialog,"onUpdate:modelValue":e[1]||(e[1]=s=>a.showLogDialog=s),"resource-id":a.currentBuildId,"task-id":d.currentTaskId,title:"编译日志","loading-text":"正在编译中，请稍候...","api-path":"/api/admin/docker/resource/{id}/logs",onClosed:a.handleLogDialogClosed},null,8,["modelValue","resource-id","task-id","onClosed"])])}const ue=O(te,[["render",re]]);export{ue as default};
