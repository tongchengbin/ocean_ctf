var S=Object.defineProperty;var V=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var k=(t,e,a)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,x=(t,e)=>{for(var a in e||(e={}))T.call(e,a)&&k(t,a,e[a]);if(V)for(var a of V(e))N.call(e,a)&&k(t,a,e[a]);return t};var C=(t,e,a)=>new Promise((g,i)=>{var d=o=>{try{u(a.next(o))}catch(c){i(c)}},f=o=>{try{u(a.throw(o))}catch(c){i(c)}},u=o=>o.done?g(o.value):Promise.resolve(o.value).then(d,f);u((a=a.apply(t,e)).next())});import{_ as P,a8 as w,aw as R,av as y,q as F,H as s,R as r,G as m,E as j,U as v,D as n,a9 as A,p as _,S as p,P as b,J as M,K as G}from"./index-DGNIR5hM.js";import H from"./editAdmin-CKo5Plti.js";const J={name:"Account",components:{EditAdmin:H},data(){return{isEdit:!1,editForm:{},TeamOptions:[],list:null,total:0,listLoading:!0,listQuery:{search:"",page:1,page_size:10},roles:[],rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirm_password:[{validator:(e,a,g)=>{!this.editForm.id&&!a?g(new Error("请再次输入密码")):a!==this.editForm.password?g(new Error("两次输入密码不一致!")):g()},trigger:"blur"}]}}},created(){this.getList()},methods:{getList(){this.listLoading=!0,w.get("/api/admin/admin",this.listQuery).then(t=>{this.list=t.data,this.total=t.total}).finally(()=>{this.listLoading=!1})},getRole(){w.get("/api/admin/role").then(t=>{this.roles=t.data})},handleDelete(t){return C(this,null,function*(){try{yield R.confirm("确认要删除该管理员吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield w.delete(`/api/admin/admin/${t.id}`),y({type:"success",message:"删除成功",duration:2e3}),this.getList()}catch(e){e!=="cancel"&&y.error("删除失败")}})},handleSizeChange(t){this.listQuery.page_size=t,this.getList()},handleCurrentChange(t){this.listQuery.page=t,this.getList()},handleFilter(){this.listQuery.page=1,this.getList()},handleCreate(t){this.getRole(),this.isEdit=!0,this.editForm=x({},t)},handleEdit(t){this.isEdit=!1,t&&this.getList()},submit(){return C(this,null,function*(){try{yield this.$refs.dataForm.validate(),this.editForm.id?(yield w.put(`/api/admin/admin/${this.editForm.id}`,this.editForm),y({type:"success",message:"修改成功",duration:2e3})):(yield w.post("/api/admin/admin",this.editForm),y({type:"success",message:"添加成功",duration:2e3})),this.isEdit=!1,this.getList()}catch(t){t!=="cancel"&&y.error(t.message||"操作失败")}})}}},K={class:"main"},O={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},I={key:1},W={class:"page-r"},X={class:"dialog-footer"};function Y(t,e,a,g,i,d){const f=n("el-input"),u=n("el-form-item"),o=n("el-button"),c=n("el-form"),h=n("el-table-column"),E=n("el-tag"),L=n("el-table"),z=n("el-pagination"),q=n("el-option"),Q=n("el-select"),B=n("el-dialog"),U=A("loading");return _(),F("div",K,[s(c,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:r(()=>[s(u,{class:"el-form-item"},{default:r(()=>[s(f,{modelValue:i.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=l=>i.listQuery.search=l),placeholder:"请输入用户名/邮箱",class:"w-[200px]"},null,8,["modelValue"])]),_:1}),s(u,null,{default:r(()=>[s(o,{type:"primary",onClick:d.handleFilter},{default:r(()=>e[8]||(e[8]=[p("查询")])),_:1},8,["onClick"]),s(o,{type:"success",onClick:e[1]||(e[1]=l=>d.handleCreate({}))},{default:r(()=>e[9]||(e[9]=[p("添加")])),_:1})]),_:1})]),_:1}),m("div",O,[e[12]||(e[12]=m("div",{class:"flex justify-between w-full h-[60px] p-4"},[m("p",{class:"font-bold truncate"},"管理员列表")],-1)),m("div",null,[j((_(),v(L,{data:i.list,"highlight-current-row":"",stripe:""},{default:r(()=>[s(h,{align:"center",type:"index",width:"80",label:"序号",fixed:"left","class-name":"fnt-12"}),s(h,{label:"用户名",width:"150",align:"center","class-name":"fnt-12"},{default:r(l=>[l.row.is_captain?(_(),v(E,{key:0,effect:"dark"},{default:r(()=>[p(b(l.row.username),1)]),_:2},1024)):(_(),F("span",I,b(l.row.username),1))]),_:1}),s(h,{align:"center",label:"角色","class-name":"fnt-12"},{default:r(l=>[m("span",null,b(l.row.role_name),1)]),_:1}),s(h,{label:"上次登陆时间",width:"160",align:"center","class-name":"fnt-12"},{default:r(l=>[m("span",null,b(l.row.login_time),1)]),_:1}),s(h,{align:"center",label:"操作",width:"200"},{default:r(l=>[s(o,{link:"",type:"primary",onClick:D=>d.handleCreate(l.row)},{default:r(()=>e[10]||(e[10]=[p("编辑")])),_:2},1032,["onClick"]),s(o,{link:"",type:"danger",onClick:D=>d.handleDelete(l.row)},{default:r(()=>e[11]||(e[11]=[p("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,i.listLoading]]),m("div",W,[s(z,{background:"","current-page":i.listQuery.page,"page-sizes":[10,20,30,50],"page-size":i.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),s(B,{modelValue:i.isEdit,"onUpdate:modelValue":e[7]||(e[7]=l=>i.isEdit=l),title:i.editForm.id?"编辑管理员":"新增管理员",width:"500px"},{footer:r(()=>[m("span",X,[s(o,{onClick:e[6]||(e[6]=l=>d.handleEdit(!1))},{default:r(()=>e[13]||(e[13]=[p("取 消")])),_:1}),s(o,{type:"primary",onClick:d.submit},{default:r(()=>e[14]||(e[14]=[p("确 定")])),_:1},8,["onClick"])])]),default:r(()=>[s(c,{ref:"dataForm",model:i.editForm,"label-width":"100px",rules:i.rules},{default:r(()=>[s(u,{label:"用户名",prop:"username",required:""},{default:r(()=>[s(f,{modelValue:i.editForm.username,"onUpdate:modelValue":e[2]||(e[2]=l=>i.editForm.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(u,{label:"角色",prop:"role",required:""},{default:r(()=>[s(Q,{modelValue:i.editForm.role,"onUpdate:modelValue":e[3]||(e[3]=l=>i.editForm.role=l),placeholder:"请选择角色",class:"w-full"},{default:r(()=>[(_(!0),F(M,null,G(i.roles,l=>(_(),v(q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{label:"密码",prop:"password",required:!i.editForm.id},{default:r(()=>[s(f,{modelValue:i.editForm.password,"onUpdate:modelValue":e[4]||(e[4]=l=>i.editForm.password=l),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1},8,["required"]),s(u,{label:"确认密码",prop:"confirm_password",required:!i.editForm.id},{default:r(()=>[s(f,{modelValue:i.editForm.confirm_password,"onUpdate:modelValue":e[5]||(e[5]=l=>i.editForm.confirm_password=l),type:"password",placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1},8,["required"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const te=P(J,[["render",Y]]);export{te as default};
