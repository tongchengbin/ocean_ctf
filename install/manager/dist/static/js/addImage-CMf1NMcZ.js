import{_ as D,az as V,ay as N,D as s,m,n as c,G as a,H as t,Q as l,R as u,K as E,L as H,P as T,a7 as F}from"./index-pPDUazPi.js";const I={name:"addImage",components:{Edit:N,Files:V},data(){return{rules:{tag:[{required:!0,max:100,min:2,message:"请输入要构建的镜像名称"}]},selectHub:"DockerHub",imageName:"",buildForm:{tag:""},options:[{value:"DockerHub",label:"DockerHub"}],file:null,output:[],pk:null,content:"",listTotal:0,listData:[],showLog:!1}},created(){this.pk=this.$route.query.id},methods:{getFile(n,e){e.length>1&&e.splice(0,1),this.file=n.raw},build(){this.$refs.build.validate(n=>{if(!n)return!1;let e;this.$refs.tab.currentName==="tar"?(e=new FormData,e.append("type","tar"),e.append("files",this.file)):this.$refs.tab.currentName==="pull"?e={tag:this.imageName}:e={dockerfile:this.content,tag:this.tag},F.post(`/api/admin/docker/image?build_type=${this.$refs.tab.currentName}&tag=${this.buildForm.tag}`,e).then(i=>{this.$message({message:"任务已提交",type:"success"}),this.showLog=!0,this.output=["Internal Server Error for url: http+docker://localhost/v1.44/build?t=test%3A%21&q=False&nocache=False&rm=True&forcerm=False&pull=False"],this.loopResponse(i.data.task)}).catch(i=>{})})},loopResponse(n){let e,i=this,f={index:this.output.length};F.get(`/api/admin/task/${n}/log`,f).then(function(o){i.output=i.output.concat(o.data);let r=document.getElementById("log_output");r.scrollTop=r.scrollHeight,o.end?clearTimeout(e):e=setTimeout(()=>{i.loopResponse(n)},5e3)})}}},q={class:"container"},B={class:"widget"},C={class:"action-group"},L={id:"log_output",class:"output",style:{"max-height":"300px",overflow:"auto"}},R={class:"line small"};function $(n,e,i,f,o,r){const y=s("Edit"),_=s("el-icon"),g=s("el-input"),b=s("el-form-item"),h=s("el-form"),d=s("el-tab-pane"),v=s("el-button"),w=s("el-upload"),k=s("el-tabs"),x=s("Files");return c(),m("div",q,[a("div",B,[t(k,{type:"border-card"},{default:l(()=>[t(d,null,{label:l(()=>[t(_,null,{default:l(()=>[t(y)]),_:1}),e[2]||(e[2]=u("添加镜像",-1))]),default:l(()=>[t(h,{model:o.buildForm,inline:"",ref:"build",rules:o.rules},{default:l(()=>[t(b,{label:"名称",prop:"tag"},{default:l(()=>[t(g,{modelValue:o.buildForm.tag,"onUpdate:modelValue":e[0]||(e[0]=p=>o.buildForm.tag=p),placeholder:"eg. redis:latest"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(k,{value:"dockerfile",ref:"tab"},{default:l(()=>[t(d,{name:"dockerfile"},{label:l(()=>[...e[3]||(e[3]=[a("i",{class:"el-icon-edit"},null,-1),u(" DockerFile",-1)])]),default:l(()=>[a("div",null,[t(h,null,{default:l(()=>[t(b,null,{default:l(()=>[t(g,{modelValue:o.content,"onUpdate:modelValue":e[1]||(e[1]=p=>o.content=p),type:"textarea",rows:"10",placeholder:"Define or paste the content of Your Dockerfile here"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),t(d,{name:"tar"},{label:l(()=>[...e[4]||(e[4]=[a("i",{class:"el-icon-upload2"},null,-1),u(" 上传",-1)])]),default:l(()=>[a("div",null,[a("div",null,[t(w,{accept:"*.tar","on-change":r.getFile,action:"",ref:"upload","auto-upload":!1},{default:l(()=>[t(v,{type:"primary"},{default:l(()=>[...e[5]||(e[5]=[u("选择文件",-1)])]),_:1})]),_:1},8,["on-change"])])])]),_:1}),t(d,{name:"pull"},{label:l(()=>[...e[6]||(e[6]=[a("i",{class:"el-icon-edit"},null,-1),u("Pull",-1)])]),_:1})]),_:1},512),a("div",null,[e[8]||(e[8]=a("div",{class:"wd-title"},"Actions",-1)),a("div",C,[t(v,{onClick:r.build,type:"primary"},{default:l(()=>[...e[7]||(e[7]=[u("上传/编译",-1)])]),_:1},8,["onClick"])])])]),_:1}),t(d,{disabled:!o.showLog},{label:l(()=>[t(_,null,{default:l(()=>[t(x)]),_:1}),e[9]||(e[9]=u("日志",-1))]),default:l(()=>[a("div",L,[(c(!0),m(E,null,H(o.output,p=>(c(),m("p",R,T(p),1))),256))])]),_:1},8,["disabled"])]),_:1})])])}const P=D(I,[["render",$],["__scopeId","data-v-9d6be9f8"]]);export{P as default};
