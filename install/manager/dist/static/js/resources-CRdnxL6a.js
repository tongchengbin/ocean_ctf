var A=Object.defineProperty;var V=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var D=(i,e,a)=>e in i?A(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a,Q=(i,e)=>{for(var a in e||(e={}))E.call(e,a)&&D(i,a,e[a]);if(V)for(var a of V(e))N.call(e,a)&&D(i,a,e[a]);return i};var C=(i,e,a)=>new Promise((t,g)=>{var _=l=>{try{p(a.next(l))}catch(s){g(s)}},y=l=>{try{p(a.throw(l))}catch(s){g(s)}},p=l=>l.done?t(l.value):Promise.resolve(l.value).then(_,y);p((a=a.apply(i,e)).next())});import{_ as j,r as w,e as q,o as M,q as L,H as n,R as r,G as b,E as U,U as T,a8 as v,ay as h,az as G,D as u,a9 as O,p as B,S as f,P,Q as I}from"./index-Dasq562Y.js";import J from"./resourceForm-CnygxTEW.js";/* empty css              */const K={name:"resources",components:{resourceForm:J},setup(i,{emit:e}){const a=w([]),t=w(!1),g=w({}),_=w(!1),y=w(0),p=w([]),l=q({type:"CTF",page:1,page_size:10,subject:null,search:null}),s=()=>C(this,null,function*(){const o=yield v.get("/api/admin/ctf/question/type");a.value=o.data}),d=()=>C(this,null,function*(){t.value=!0;try{const o=yield v.get("/api/admin/docker/resource",l);p.value=o.data,y.value=o.total}finally{t.value=!1}}),m=()=>C(this,null,function*(){try{yield v.post("/api/admin/ctf/sync_repo"),h({type:"success",message:"任务提交成功",duration:2e3})}catch(o){h.error("同步失败")}}),x=o=>{l.page_size=o,d()},z=o=>{l.page=o,d()},R=()=>{g.value={},_.value=!0},S=o=>C(this,null,function*(){try{yield v.post(`/api/admin/docker/resource/${o.id}/build`),h({type:"success",message:"任务已提交",duration:2e3}),yield d()}catch(H){h.error("编译失败")}}),c=o=>{_.value=!0,g.value=Q({},o)},k=o=>C(this,null,function*(){try{yield G.confirm("确认要删除该资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield v.delete(`/api/admin/docker/resource/${o.id}`),h({type:"success",message:"删除成功",duration:2e3}),yield d()}catch(H){H!=="cancel"&&h.error("删除失败")}}),F=o=>{_.value=!1,o&&d()};return M(()=>{d(),s()}),{qType:a,listQuery:l,loading:t,currentRow:g,showResourceForm:_,total:y,listData:p,getList:d,handleSyncRemoteCtfRepo:m,handleSizeChange:x,handleCurrentChange:z,handleCreate:R,buildHandle:S,editHandle:c,deleteHandle:k,handleAdd:F}}},W={class:"main"},X={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},Y={class:"page-r"};function Z(i,e,a,t,g,_){const y=u("resource-form"),p=u("el-input"),l=u("el-form-item"),s=u("el-button"),d=u("el-form"),m=u("el-table-column"),x=u("el-tag"),z=u("el-table"),R=u("el-pagination"),S=O("loading");return B(),L("div",W,[n(y,{data:t.currentRow,open:t.showResourceForm,onAction:t.handleAdd},null,8,["data","open","onAction"]),n(d,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:r(()=>[n(l,{class:"el-form-item",label:"资源名称"},{default:r(()=>[n(p,{modelValue:t.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=c=>t.listQuery.search=c),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(l,null,{default:r(()=>[n(s,{style:{margin:"0 5px"},type:"primary",onClick:t.getList},{default:r(()=>e[1]||(e[1]=[f("查询")])),_:1},8,["onClick"]),n(s,{type:"success",onClick:t.handleCreate},{default:r(()=>e[2]||(e[2]=[f("添加")])),_:1},8,["onClick"]),n(s,{type:"warning",onClick:t.handleSyncRemoteCtfRepo},{default:r(()=>e[3]||(e[3]=[f("同步仓库资源")])),_:1},8,["onClick"])]),_:1})]),_:1}),b("div",X,[e[7]||(e[7]=b("div",{class:"flex justify-between w-full h-[60px] p-4"},[b("p",{class:"font-bold truncate"},"CTF环境资源")],-1)),b("div",null,[U((B(),T(z,{fit:"","highlight-current-row":"",stripe:"",data:t.listData},{default:r(()=>[n(m,{align:"center",label:"标题",prop:"name",width:"220","class-name":"fnt-12"}),n(m,{align:"center",label:"镜像",prop:"image","class-name":"fnt-12"}),n(m,{align:"center",label:"加载方式",prop:"docker_type_name",width:"180","class-name":"fnt-12"}),n(m,{align:"center",label:"状态",prop:"status_name",width:"120"},{default:r(c=>[n(x,{type:c.row.status===1?"success":"info"},{default:r(()=>[f(P(c.row.status_name),1)]),_:2},1032,["type"])]),_:1}),n(m,{align:"center",label:"添加日期",prop:"date_created",width:"150","class-name":"fnt-12"}),n(m,{align:"center",label:"操作",width:"240"},{default:r(c=>[c.row.status===0?(B(),T(s,{key:0,link:"",type:"primary",onClick:k=>t.buildHandle(c.row)},{default:r(()=>e[4]||(e[4]=[f("编译")])),_:2},1032,["onClick"])):I("",!0),n(s,{link:"",type:"primary",onClick:k=>t.editHandle(c.row)},{default:r(()=>e[5]||(e[5]=[f("编辑")])),_:2},1032,["onClick"]),n(s,{link:"",type:"danger",onClick:k=>t.deleteHandle(c.row)},{default:r(()=>e[6]||(e[6]=[f("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[S,t.loading]]),b("div",Y,[n(R,{"current-page":t.listQuery.page,"page-size":t.listQuery.page_size,"page-sizes":[10,20,30,50],total:t.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])])}const ne=j(K,[["render",Z]]);export{ne as default};
