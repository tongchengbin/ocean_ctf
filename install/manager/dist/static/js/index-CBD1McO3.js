var f=(i,e,s)=>new Promise((V,l)=>{var d=n=>{try{r(s.next(n))}catch(c){l(c)}},b=n=>{try{r(s.throw(n))}catch(c){l(c)}},r=n=>n.done?V(n.value):Promise.resolve(n.value).then(d,b);r((s=s.apply(i,e)).next())});import{_ as L,D as u,a9 as T,m as B,n as x,H as t,G as _,Q as a,R as w,F as D,S,a7 as h,av as p,aw as F}from"./index-pPDUazPi.js";const E={name:"index",data(){return{edit:!1,list:[],total:0,listLoading:!0,listQuery:{is_top:null,search:null,active:null,page:1,page_size:10},form:{id:null,isTop:!1,active:!0,content:""},rules:{content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]}}},created(){this.getList()},methods:{getList(){return f(this,null,function*(){this.listLoading=!0;try{const i=yield h.get("/api/admin/notice",this.listQuery),{data:e,total:s}=i;this.list=e,this.total=s}catch(i){p.error(i.message||"获取列表失败")}finally{this.listLoading=!1}})},changeTop(i,e){return f(this,null,function*(){try{yield h.put(`/api/admin/notice/${e.id}`,{isTop:i}),p({type:"success",message:"更新成功"})}catch(s){e.is_top=!i,p.error(s.message||"更新失败")}})},changeActive(i,e){return f(this,null,function*(){try{yield h.put(`/api/admin/notice/${e.id}`,{active:i}),p({type:"success",message:"更新成功"})}catch(s){e.active=!i,p.error(s.message||"更新失败")}})},handleDelete(i){return f(this,null,function*(){try{yield F.confirm("确认要删除该公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield h.delete(`/api/admin/notice/${i.id}`),p({type:"success",message:"删除成功"}),this.getList()}catch(e){e!=="cancel"&&p.error(e.message||"删除失败")}})},handleSizeChange(i){this.listQuery.page_size=i,this.getList()},handleCurrentChange(i){this.listQuery.page=i,this.getList()},handleFilter(){this.listQuery.page=1,this.getList()},handleCreate(){this.form={id:null,isTop:!1,active:!0,content:""},this.edit=!0},actionForm(){return f(this,null,function*(){try{yield this.$refs.formRef.validate(),this.form.id?yield h.put(`/api/admin/notice/${this.form.id}`,this.form):yield h.post("/api/admin/notice",this.form),p({type:"success",message:"保存成功"}),this.edit=!1,this.getList()}catch(i){i!=="cancel"&&p.error(i.message||"保存失败")}})}}},N={class:"main"},R={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},j={class:"page-r"},A={class:"dialog-footer"};function M(i,e,s,V,l,d){const b=u("el-input"),r=u("el-form-item"),n=u("el-option"),c=u("el-select"),y=u("el-button"),C=u("el-form"),g=u("el-table-column"),v=u("el-switch"),k=u("el-table"),Q=u("el-pagination"),z=u("el-dialog"),U=T("loading");return x(),B("div",N,[t(C,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0,model:l.listQuery},{default:a(()=>[t(r,null,{default:a(()=>[t(b,{modelValue:l.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=o=>l.listQuery.search=o),placeholder:"请输入公告内容",class:"w-[200px]",clearable:""},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(c,{modelValue:l.listQuery.active,"onUpdate:modelValue":e[1]||(e[1]=o=>l.listQuery.active=o),placeholder:"是否启用",clearable:"",style:{width:"120px"}},{default:a(()=>[t(n,{key:"1",label:"启用",value:"1"}),t(n,{key:"0",label:"未启用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(c,{modelValue:l.listQuery.is_top,"onUpdate:modelValue":e[2]||(e[2]=o=>l.listQuery.is_top=o),placeholder:"是否置顶",clearable:"",style:{width:"120px"}},{default:a(()=>[t(n,{key:"1",label:"是",value:"1"}),t(n,{key:"0",label:"否",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(y,{type:"primary",onClick:d.handleFilter},{default:a(()=>[...e[10]||(e[10]=[w("查询",-1)])]),_:1},8,["onClick"]),t(y,{type:"success",onClick:d.handleCreate},{default:a(()=>[...e[11]||(e[11]=[w("添加",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),_("div",R,[e[13]||(e[13]=_("div",{class:"flex justify-between w-full page-title"},[_("p",{class:"font-bold truncate"},"公告列表")],-1)),_("div",null,[D((x(),S(k,{data:l.list,fit:"","highlight-current-row":"",stripe:""},{default:a(()=>[t(g,{align:"center",label:"ID",width:"70",prop:"id"}),t(g,{label:"内容",align:"center",prop:"content"}),t(g,{label:"是否显示",width:"80",align:"center"},{default:a(o=>[t(v,{modelValue:o.row.active,"onUpdate:modelValue":m=>o.row.active=m,onChange:m=>d.changeActive(m,o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(g,{label:"是否置顶",width:"80",align:"center"},{default:a(o=>[t(v,{modelValue:o.row.is_top,"onUpdate:modelValue":m=>o.row.is_top=m,onChange:m=>d.changeTop(m,o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(g,{align:"center",label:"发布日期",prop:"updated_at"}),t(g,{label:"操作",width:"120",align:"center"},{default:a(o=>[t(y,{type:"danger",link:"",onClick:m=>d.handleDelete(o.row)},{default:a(()=>[...e[12]||(e[12]=[w(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,l.listLoading]]),_("div",j,[t(Q,{"current-page":l.listQuery.page,"onUpdate:currentPage":e[3]||(e[3]=o=>l.listQuery.page=o),"page-size":l.listQuery.page_size,"onUpdate:pageSize":e[4]||(e[4]=o=>l.listQuery.page_size=o),"page-sizes":[10,20,30,50],total:l.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),t(z,{modelValue:l.edit,"onUpdate:modelValue":e[9]||(e[9]=o=>l.edit=o),title:l.form.id?"编辑公告":"添加公告",width:"500px",center:"","destroy-on-close":""},{footer:a(()=>[_("div",A,[t(y,{onClick:e[8]||(e[8]=o=>l.edit=!1)},{default:a(()=>[...e[14]||(e[14]=[w("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:d.actionForm},{default:a(()=>[...e[15]||(e[15]=[w("确定",-1)])]),_:1},8,["onClick"])])]),default:a(()=>[t(C,{ref:"formRef",model:l.form,rules:l.rules,"label-width":"80px"},{default:a(()=>[t(r,{label:"是否公开",prop:"active"},{default:a(()=>[t(v,{modelValue:l.form.active,"onUpdate:modelValue":e[5]||(e[5]=o=>l.form.active=o)},null,8,["modelValue"])]),_:1}),t(r,{label:"是否置顶",prop:"isTop"},{default:a(()=>[t(v,{modelValue:l.form.isTop,"onUpdate:modelValue":e[6]||(e[6]=o=>l.form.isTop=o)},null,8,["modelValue"])]),_:1}),t(r,{label:"内容",prop:"content"},{default:a(()=>[t(b,{modelValue:l.form.content,"onUpdate:modelValue":e[7]||(e[7]=o=>l.form.content=o),type:"textarea",rows:"4",placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const H=L(E,[["render",M]]);export{H as default};
