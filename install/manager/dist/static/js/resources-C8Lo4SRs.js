var m=(e,t,c)=>new Promise((z,n)=>{var i=p=>{try{w(c.next(p))}catch(o){n(o)}},v=p=>{try{w(c.throw(p))}catch(o){n(o)}},w=p=>p.done?z(p.value):Promise.resolve(p.value).then(i,v);w((c=c.apply(e,t)).next())});import{_ as E,D as u,a9 as B,m as V,n as f,S as C,E as L,H as s,G as y,Q as l,R as d,F as T,P as b,K as q,L as F,a7 as h,av as r,aw as N}from"./index-pPDUazPi.js";import R from"./resourceItem-DBMMG1Ua.js";import"./index-CZTWs2AU.js";const U={name:"resources",components:{resourceItem:R},data(){return{qType:[],listQuery:{page:1,page_size:10,subject:null,search:null},loading:!1,chiData:{},showAddQuestion:!1,total:0,listData:[],rid:null,captureName:null,showLogs:!1,currentLogs:""}},created(){this.getList(),this.getOptions()},methods:{getOptions(){h.get("/api/admin/ctf/question/type").then(e=>{this.qType=e.data}).catch(e=>{r.error(e.message||"获取数据失败")})},getList(){this.loading=!0,h.get("/api/admin/vulnerability",this.listQuery).then(e=>{this.listData=e.data,this.total=e.total}).catch(e=>{r.error(e.message||"获取数据失败")}).finally(()=>{this.loading=!1})},handleSizeChange(e){this.listQuery.page_size=e,this.getList()},handleCurrentChange(e){this.listQuery.page=e,this.getList()},handleSyncRemoteVulnerabilityRepo(){return m(this,null,function*(){try{yield h.post("/api/admin/vulnerability/sync_vulnerability",{}),r({type:"success",message:"任务提交成功",duration:2e3}),this.getList()}catch(e){r.error(e.message||"同步失败")}})},handleUpload(){const e=document.createElement("input");e.type="file",e.addEventListener("change",this.handleFileUpload),e.click()},handleFileUpload(e){return m(this,null,function*(){try{const t=e.target.files[0],c=new FormData;c.append("file",t),yield h.post("/api/admin/vulnerability/import",c),r({type:"success",message:"导入成功",duration:2e3}),this.getList()}catch(t){r.error(t.message||"导入失败")}})},handleCreate(){this.$router.replace({name:"vulnerability_edit_resource"})},buildHandle(e){return m(this,null,function*(){try{yield h.post(`/api/admin/docker/resource/${e.id}/build`),r({type:"success",message:"任务已提交",duration:2e3}),this.getList()}catch(t){r.error(t.message||"编译失败")}})},editHandle(e){this.$router.replace({name:"vulnerability_edit_resource",query:{id:e.id}})},runHandle(e){return m(this,null,function*(){try{yield h.post(`/api/admin/vulnerability/${e.id}/run`),r({type:"success",message:"启动成功",duration:2e3}),this.getList()}catch(t){r.error(t.message||"启动失败")}})},deleteHandle(e){return m(this,null,function*(){try{yield N.confirm("确认要删除该漏洞资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield h.delete(`/api/admin/vulnerability/${e.id}`),r({type:"success",message:"删除成功",duration:2e3}),this.getList()}catch(t){t!=="cancel"&&r.error(t.message||"删除失败")}})},handleAdd(e){this.showAddQuestion=!1,e&&this.getList()},getStatusType(e){return{0:"info",1:"success",2:"danger"}[e]||"info"},switchActive(e,t){return m(this,null,function*(){try{yield h.put(`/api/admin/ctf/question/${t.id}`,{active:e}),r({type:"success",message:"修改成功",duration:2e3})}catch(c){r.error(c.message||"修改失败")}})},viewLogs(e){return m(this,null,function*(){this.currentLogs=e.logs||"暂无日志",this.showLogs=!0})}}},M={class:"main"},j={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},I={class:"mr-1"},O={class:"page-r"},G={class:"log-content"},K={class:"shell-style"};function P(e,t,c,z,n,i){const v=u("resourceItem"),w=u("el-input"),p=u("el-form-item"),o=u("el-button"),x=u("el-tooltip"),Q=u("el-form"),_=u("el-table-column"),k=u("el-tag"),D=u("el-table"),S=u("el-pagination"),A=u("el-dialog"),H=B("loading");return f(),V("div",M,[n.showAddQuestion?(f(),C(v,{key:0,data:n.chiData,show:n.showAddQuestion,onAction:i.handleAdd},null,8,["data","show","onAction"])):L("",!0),s(Q,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:l(()=>[s(p,{class:"el-form-item"},{default:l(()=>[s(w,{modelValue:n.listQuery.search,"onUpdate:modelValue":t[0]||(t[0]=a=>n.listQuery.search=a),placeholder:"请输入名称、app或CVE",class:"w-[200px]"},null,8,["modelValue"])]),_:1}),s(p,null,{default:l(()=>[s(o,{type:"primary",onClick:i.getList},{default:l(()=>[...t[2]||(t[2]=[d("查询",-1)])]),_:1},8,["onClick"]),s(o,{type:"success",onClick:i.handleCreate},{default:l(()=>[...t[3]||(t[3]=[d("添加",-1)])]),_:1},8,["onClick"]),s(o,{type:"primary",onClick:i.handleSyncRemoteVulnerabilityRepo},{default:l(()=>[s(x,{content:"同步远程仓库漏洞环境"},{default:l(()=>[...t[4]||(t[4]=[d("同步",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),y("div",j,[t[10]||(t[10]=y("div",{class:"flex justify-between w-full page-title"},[y("p",{class:"font-bold truncate"},"漏洞资源列表")],-1)),y("div",null,[T((f(),C(D,{fit:"","highlight-current-row":"",stripe:"",data:n.listData},{default:l(()=>[s(_,{align:"center",label:"标题",prop:"name",width:"220","class-name":"fnt-12"}),s(_,{align:"center",label:"组件",prop:"app",width:"220","class-name":"fnt-12"}),s(_,{align:"center",label:"镜像",prop:"image","class-name":"fnt-12"},{default:l(a=>[y("span",I,b(a.row.image),1),s(k,{size:"small",type:"primary"},{default:l(()=>[d(b(a.row.docker_type===1?"远程":"本地"),1)]),_:2},1024)]),_:1}),s(_,{align:"center",label:"状态",prop:"status_name",width:"180","class-name":"fnt-12"},{default:l(a=>[s(k,{type:i.getStatusType(a.row.status),size:"small",style:{cursor:"pointer"},onClick:g=>a.row.status===2&&i.viewLogs(a.row)},{default:l(()=>[d(b(a.row.status_name),1)]),_:2},1032,["type","onClick"])]),_:1}),s(_,{align:"center",label:"CVE",prop:"cve",width:"220","class-name":"fnt-12"},{default:l(a=>[(f(!0),V(q,null,F(a.row.cve,g=>(f(),C(k,{key:g,class:"mr-1 mb-1",size:"small"},{default:l(()=>[d(b(g),1)]),_:2},1024))),128))]),_:1}),s(_,{align:"center",label:"添加日期",prop:"created_at",width:"150","show-overflow-tooltip":"","class-name":"fnt-12"}),s(_,{align:"left",label:"操作",width:"240"},{default:l(a=>[s(o,{link:"",type:"primary",onClick:g=>i.buildHandle(a.row)},{default:l(()=>[...t[5]||(t[5]=[d("编译",-1)])]),_:1},8,["onClick"]),a.row.status===1?(f(),C(o,{key:0,link:"",type:"primary",onClick:g=>i.runHandle(a.row)},{default:l(()=>[...t[6]||(t[6]=[d("启动",-1)])]),_:1},8,["onClick"])):L("",!0),s(o,{link:"",type:"primary",onClick:g=>i.editHandle(a.row)},{default:l(()=>[...t[7]||(t[7]=[d("编辑",-1)])]),_:1},8,["onClick"]),s(o,{link:"",type:"danger",onClick:g=>i.deleteHandle(a.row)},{default:l(()=>[...t[8]||(t[8]=[d("删除",-1)])]),_:1},8,["onClick"]),a.row.logs||a.row.status===2?(f(),C(o,{key:1,link:"",type:a.row.status===2?"danger":"info",onClick:g=>i.viewLogs(a.row)},{default:l(()=>[...t[9]||(t[9]=[d(" 日志 ",-1)])]),_:1},8,["type","onClick"])):L("",!0)]),_:1})]),_:1},8,["data"])),[[H,n.loading]]),y("div",O,[s(S,{"current-page":n.listQuery.page,"page-size":n.listQuery.page_size,"page-sizes":[10,20,30,50],total:n.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i.handleSizeChange,onCurrentChange:i.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),s(A,{modelValue:n.showLogs,"onUpdate:modelValue":t[1]||(t[1]=a=>n.showLogs=a),title:"编译日志",width:"60%",class:"log-dialog","destroy-on-close":""},{default:l(()=>[y("div",G,[y("pre",K,b(n.currentLogs),1)])]),_:1},8,["modelValue"])])}const Z=E(U,[["render",P]]);export{Z as default};
