var E=Object.defineProperty;var H=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var R=(d,e,o)=>e in d?E(d,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[e]=o,S=(d,e)=>{for(var o in e||(e={}))N.call(e,o)&&R(d,o,e[o]);if(H)for(var o of H(e))q.call(e,o)&&R(d,o,e[o]);return d};var v=(d,e,o)=>new Promise((a,_)=>{var y=r=>{try{m(o.next(r))}catch(l){_(l)}},w=r=>{try{m(o.throw(r))}catch(l){_(l)}},m=r=>r.done?a(r.value):Promise.resolve(r.value).then(y,w);m((o=o.apply(d,e)).next())});import{_ as I,D as u,a9 as U,m as G,n as F,H as n,G as k,Q as s,R as f,F as O,S as P,P as J,r as p,e as K,o as W,a7 as x,aw as X,av as C}from"./index-BYxaA_Lm.js";import Y from"./resourceForm-B2qJECoX.js";import{B as Z}from"./index-CR7Cr9n7.js";/* empty css              */const $={name:"resources",components:{resourceForm:Y,BuildLogViewer:Z},setup(d,{emit:e}){const o=p([]),a=p(!1),_=p({}),y=p(!1),w=p(0),m=p([]),r=p(!1),l=p(null),h=p({}),c=K({type:"CTF",page:1,page_size:10,subject:null,search:null}),L=()=>v(null,null,function*(){const t=yield x.get("/api/admin/ctf/question/type");o.value=t.data}),g=()=>v(null,null,function*(){a.value=!0;try{const t=yield x.get("/api/admin/docker/resource",c);m.value=t.data,w.value=t.total}finally{a.value=!1}}),z=()=>v(null,null,function*(){try{yield x.post("/api/admin/ctf/sync_repo"),C({type:"success",message:"任务提交成功",duration:2e3})}catch(t){C.error("同步失败")}}),B=t=>{c.page_size=t,g()},D=t=>{c.page=t,g()},i=()=>{_.value={},y.value=!0},b=t=>v(null,null,function*(){try{l.value=t.id,h.value[t.id]=!0,yield x.post(`/api/admin/docker/resource/${t.id}/build`),C({type:"success",message:"任务已提交",duration:2e3}),r.value=!0,yield g()}catch(V){C.error("编译失败")}finally{h.value[t.id]=!1}}),Q=t=>{y.value=!0,_.value=S({},t)},T=t=>v(null,null,function*(){try{yield X.confirm("确认要删除该资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield x.delete(`/api/admin/docker/resource/${t.id}`),C({type:"success",message:"删除成功",duration:2e3}),yield g()}catch(V){V!=="cancel"&&C.error("删除失败")}}),M=t=>{y.value=!1,t&&g()},A=()=>{l.value=null},j=t=>{l.value=t.id,r.value=!0};return W(()=>{g(),L()}),{qType:o,listQuery:c,loading:a,currentRow:_,showResourceForm:y,total:w,listData:m,showLogDialog:r,currentBuildId:l,buildLoadingMap:h,handleLogDialogClosed:A,getList:g,handleSyncRemoteCtfRepo:z,handleSizeChange:B,handleCurrentChange:D,handleCreate:i,buildHandle:b,editHandle:Q,deleteHandle:T,handleAdd:M,viewLogHandle:j}}},ee={class:"main"},ae={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},te={class:"page-r"};function ne(d,e,o,a,_,y){const w=u("resource-form"),m=u("el-input"),r=u("el-form-item"),l=u("el-button"),h=u("el-form"),c=u("el-table-column"),L=u("el-tag"),g=u("el-table"),z=u("el-pagination"),B=u("build-log-viewer"),D=U("loading");return F(),G("div",ee,[n(w,{data:a.currentRow,open:a.showResourceForm,onAction:a.handleAdd},null,8,["data","open","onAction"]),n(h,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:s(()=>[n(r,{class:"el-form-item",label:"资源名称"},{default:s(()=>[n(m,{modelValue:a.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=i=>a.listQuery.search=i),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(r,null,{default:s(()=>[n(l,{style:{margin:"0 5px"},type:"primary",onClick:a.getList},{default:s(()=>[...e[2]||(e[2]=[f("查询",-1)])]),_:1},8,["onClick"]),n(l,{type:"success",onClick:a.handleCreate},{default:s(()=>[...e[3]||(e[3]=[f("添加",-1)])]),_:1},8,["onClick"]),n(l,{type:"warning",onClick:a.handleSyncRemoteCtfRepo},{default:s(()=>[...e[4]||(e[4]=[f("同步仓库资源",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),k("div",ae,[e[9]||(e[9]=k("div",{class:"flex justify-between w-full h-[60px] p-4"},[k("p",{class:"font-bold truncate"},"CTF环境资源")],-1)),k("div",null,[O((F(),P(g,{fit:"","highlight-current-row":"",stripe:"",data:a.listData},{default:s(()=>[n(c,{align:"center",label:"标题",prop:"name",width:"220","class-name":"fnt-12"}),n(c,{align:"center",label:"镜像",prop:"image","class-name":"fnt-12"}),n(c,{align:"center",label:"加载方式",prop:"docker_type_name",width:"180","class-name":"fnt-12"}),n(c,{align:"center",label:"状态",prop:"status_name",width:"120"},{default:s(i=>[n(L,{type:i.row.status===1?"success":"info"},{default:s(()=>[f(J(i.row.status_name),1)]),_:2},1032,["type"])]),_:1}),n(c,{align:"center",label:"添加日期",prop:"created_at",width:"150","class-name":"fnt-12"}),n(c,{align:"center",label:"操作",width:"280"},{default:s(i=>[n(l,{link:"",type:"primary",loading:a.buildLoadingMap[i.row.id],onClick:b=>a.buildHandle(i.row)},{default:s(()=>[...e[5]||(e[5]=[f("编译",-1)])]),_:1},8,["loading","onClick"]),n(l,{link:"",type:"primary",onClick:b=>a.viewLogHandle(i.row)},{default:s(()=>[...e[6]||(e[6]=[f("日志",-1)])]),_:1},8,["onClick"]),n(l,{link:"",type:"primary",onClick:b=>a.editHandle(i.row)},{default:s(()=>[...e[7]||(e[7]=[f("编辑",-1)])]),_:1},8,["onClick"]),n(l,{link:"",type:"danger",onClick:b=>a.deleteHandle(i.row)},{default:s(()=>[...e[8]||(e[8]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[D,a.loading]]),k("div",te,[n(z,{"current-page":a.listQuery.page,"page-size":a.listQuery.page_size,"page-sizes":[10,20,30,50],total:a.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),n(B,{modelValue:a.showLogDialog,"onUpdate:modelValue":e[1]||(e[1]=i=>a.showLogDialog=i),"resource-id":a.currentBuildId,title:"编译日志","loading-text":"正在编译中，请稍候...","api-path":"/api/admin/docker/resource/{id}/logs",onClosed:a.handleLogDialogClosed},null,8,["modelValue","resource-id","onClosed"])])}const de=I($,[["render",ne]]);export{de as default};
