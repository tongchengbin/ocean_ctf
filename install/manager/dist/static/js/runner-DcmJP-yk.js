var w=(e,t,p)=>new Promise((x,n)=>{var r=i=>{try{h(p.next(i))}catch(c){n(c)}},v=i=>{try{h(p.throw(i))}catch(c){n(c)}},h=i=>i.done?x(i.value):Promise.resolve(i.value).then(r,v);h((p=p.apply(e,t)).next())});import{_ as V,a8 as _,ay as m,az as q,q as b,U as C,Q as D,H as a,R as s,G as f,E as S,D as o,a9 as N,p as u,S as g,P as k,J as T,K as E}from"./index-Dasq562Y.js";import I from"./resourceItem-Oioo3pTH.js";import"./mavon-editor-DCJ9HoOI.js";/* empty css              */const j={name:"resources",components:{resourceItem:I},data(){return{qType:[],listQuery:{page:1,page_size:10,subject:null,search:null},loading:!1,chiData:{},showAddQuestion:!1,total:0,listData:[],rid:null,captureName:null}},created(){this.getList(),this.getOptions()},methods:{getOptions(){_.get("/api/admin/ctf/question/type").then(e=>{this.qType=e.data})},getList(){this.loading=!0,_.get("/api/admin/vulnerability/runner",this.listQuery).then(e=>{this.listData=e.data,this.total=e.total}).catch(e=>{m.error(e.message||"获取数据失败")}).finally(()=>{this.loading=!1})},handleSizeChange(e){this.listQuery.page_size=e,this.getList()},handleCurrentChange(e){this.listQuery.page=e,this.getList()},buildHandle(e){return w(this,null,function*(){try{yield _.post(`/api/admin/docker/resource/${e.id}/build`),m({type:"success",message:"任务已提交",duration:2e3}),this.getList()}catch(t){m.error(t.message||"操作失败")}})},editHandle(e){this.$router.push({name:"vulnerability.edit_resource",query:{id:e.id}})},destroyHandle(e){return w(this,null,function*(){try{yield q.confirm("确认要销毁该资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield _.post("/api/admin/vulnerability/runner/destroy",{id:e.id}),m({type:"success",message:"销毁成功",duration:2e3}),this.getList()}catch(t){t!=="cancel"&&m.error(t.message||"操作失败")}})},handleAdd(e){this.showAddQuestion=!1,e&&this.getList()},switchActive(e,t){return w(this,null,function*(){try{yield _.put(`/api/admin/ctf/question/${t.id}`,{active:e}),m({type:"success",message:"修改成功",duration:2e3})}catch(p){m.error(p.message||"操作失败")}})}}},M={class:"main"},O={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},U={key:1},F={class:"page-r"};function G(e,t,p,x,n,r){const v=o("resourceItem"),h=o("el-input"),i=o("el-form-item"),c=o("el-button"),A=o("el-form"),z=o("el-tag"),d=o("el-table-column"),L=o("el-table"),B=o("el-pagination"),H=N("loading");return u(),b("div",M,[n.showAddQuestion?(u(),C(v,{key:0,data:n.chiData,show:n.showAddQuestion,onAction:r.handleAdd},null,8,["data","show","onAction"])):D("",!0),a(A,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:s(()=>[a(i,{class:"el-form-item"},{default:s(()=>[a(h,{modelValue:n.listQuery.search,"onUpdate:modelValue":t[0]||(t[0]=l=>n.listQuery.search=l),placeholder:"请输入题目名称",class:"w-[200px]"},null,8,["modelValue"])]),_:1}),a(i,null,{default:s(()=>[a(c,{type:"primary",onClick:r.getList},{default:s(()=>t[1]||(t[1]=[g("查询")])),_:1},8,["onClick"])]),_:1})]),_:1}),f("div",O,[t[5]||(t[5]=f("div",{class:"flex justify-between w-full page-title"},[f("p",{class:"font-bold truncate"},"资源列表")],-1)),f("div",null,[S((u(),C(L,{fit:"","highlight-current-row":"",stripe:"",data:n.listData},{default:s(()=>[a(d,{align:"center",label:"用户",prop:"username",width:"180","class-name":"fnt-12"},{default:s(l=>[l.row.admin_id?(u(),C(z,{key:0,effect:"dark"},{default:s(()=>[g(k(l.row.username),1)]),_:2},1024)):(u(),b("span",U,k(l.row.username),1))]),_:1}),a(d,{align:"center",label:"标题",prop:"resource.name",width:"220","class-name":"fnt-12"}),a(d,{align:"center",label:"组件",prop:"resource.app",width:"180","class-name":"fnt-12"}),a(d,{align:"center",label:"镜像",prop:"resource.image","show-overflow-tooltip":"","class-name":"fnt-12"}),a(d,{align:"center",label:"容器ID",prop:"container_id",width:"160","class-name":"fnt-12"}),a(d,{align:"center",label:"端口信息",prop:"port_info",width:"200","class-name":"fnt-12"},{default:s(l=>[(u(!0),b(T,null,E(l.row.port_info,(y,Q)=>(u(),b("div",{key:Q,class:"mb-1"},[a(z,{size:"small"},{default:s(()=>[g(k(Q)+":"+k(y),1)]),_:2},1024)]))),128))]),_:1}),a(d,{align:"center",label:"启动时间",prop:"date_created",width:"200","class-name":"fnt-12"}),a(d,{align:"center",label:"操作",width:"220"},{default:s(l=>[l.row.status===0?(u(),C(c,{key:0,link:"",type:"primary",onClick:y=>r.buildHandle(l.row)},{default:s(()=>t[2]||(t[2]=[g("编译")])),_:2},1032,["onClick"])):D("",!0),a(c,{link:"",type:"primary",onClick:y=>r.editHandle(l.row)},{default:s(()=>t[3]||(t[3]=[g("编辑")])),_:2},1032,["onClick"]),a(c,{link:"",type:"danger",onClick:y=>r.destroyHandle(l.row)},{default:s(()=>t[4]||(t[4]=[g("销毁")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,n.loading]]),f("div",F,[a(B,{"current-page":n.listQuery.page,"page-size":n.listQuery.page_size,"page-sizes":[10,20,30,50],total:n.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])])}const X=V(j,[["render",G]]);export{X as default};
