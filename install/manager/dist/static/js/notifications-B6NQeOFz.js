var h=(t,e,g)=>new Promise((C,s)=>{var i=l=>{try{d(g.next(l))}catch(p){s(p)}},y=l=>{try{d(g.throw(l))}catch(p){s(p)}},d=l=>l.done?C(l.value):Promise.resolve(l.value).then(i,y);d((g=g.apply(t,e)).next())});import{_ as Q,a8 as f,av as c,aw as b,q as L,H as a,R as n,G as m,E as V,U as v,D as r,a9 as S,p as w,S as _,P as R,Q as T}from"./index-DGNIR5hM.js";const E={name:"notifications",data(){return{listQuery:{page:1,page_size:10,search:null},loading:!1,total:0,listData:[]}},created(){this.getList()},methods:{getList(){this.loading=!0,f.get("/api/admin/message",this.listQuery).then(t=>{this.listData=t.results,this.total=t.total}).catch(t=>{c.error(t.message||"获取数据失败")}).finally(()=>{this.loading=!1})},handleSizeChange(t){this.listQuery.page_size=t,this.getList()},handleCurrentChange(t){this.listQuery.page=t,this.getList()},handleRead(t){return h(this,null,function*(){try{yield f.post("/api/admin/message/read",{ids:[t.id]}),c({type:"success",message:"标记已读成功",duration:2e3}),this.getList()}catch(e){c.error(e.message||"操作失败")}})},handleReadAll(){return h(this,null,function*(){try{yield b.confirm("确定要将所有通知标记为已读吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield f.post("/api/admin/message/read_all"),c({type:"success",message:"标记已读成功",duration:2e3}),this.getList()}catch(t){t!=="cancel"&&c.error(t.message||"操作失败")}})},handleDelete(t){return h(this,null,function*(){try{yield b.confirm("确定要删除该通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield f.delete(`/api/admin/message/${t.id}`),c({type:"success",message:"删除成功",duration:2e3}),this.getList()}catch(e){e!=="cancel"&&c.error(e.message||"删除失败")}})}}},N={class:"main"},j={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},A={class:"page-r"};function M(t,e,g,C,s,i){const y=r("el-input"),d=r("el-form-item"),l=r("el-button"),p=r("el-form"),u=r("el-table-column"),k=r("el-tag"),x=r("el-table"),z=r("el-pagination"),B=S("loading");return w(),L("div",N,[a(p,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:n(()=>[a(d,{class:"el-form-item"},{default:n(()=>[a(y,{modelValue:s.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=o=>s.listQuery.search=o),placeholder:"请输入通知内容",class:"w-[200px]"},null,8,["modelValue"])]),_:1}),a(d,null,{default:n(()=>[a(l,{type:"primary",onClick:i.getList},{default:n(()=>e[1]||(e[1]=[_("查询")])),_:1},8,["onClick"]),a(l,{type:"success",onClick:i.handleReadAll},{default:n(()=>e[2]||(e[2]=[_("一键已读")])),_:1},8,["onClick"])]),_:1})]),_:1}),m("div",j,[e[5]||(e[5]=m("div",{class:"flex justify-between w-full page-title"},[m("p",{class:"font-bold truncate"},"通知列表")],-1)),m("div",null,[V((w(),v(x,{fit:"","highlight-current-row":"",stripe:"",data:s.listData},{default:n(()=>[a(u,{align:"center",label:"通知标题",prop:"title","show-overflow-tooltip":"","min-width":"200"}),a(u,{align:"center",label:"通知内容",prop:"description","show-overflow-tooltip":"","min-width":"300"}),a(u,{align:"center",label:"状态",width:"100"},{default:n(o=>[a(k,{type:o.row.is_read?"info":"warning",size:"small"},{default:n(()=>[_(R(o.row.read?"已读":"未读"),1)]),_:2},1032,["type"])]),_:1}),a(u,{align:"center",label:"通知时间",prop:"datetime",width:"180"}),a(u,{align:"center",label:"操作",width:"150"},{default:n(o=>[o.row.read?T("",!0):(w(),v(l,{key:0,link:"",type:"primary",onClick:D=>i.handleRead(o.row)},{default:n(()=>e[3]||(e[3]=[_(" 标记已读 ")])),_:2},1032,["onClick"])),a(l,{link:"",type:"danger",onClick:D=>i.handleDelete(o.row)},{default:n(()=>e[4]||(e[4]=[_(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,s.loading]]),m("div",A,[a(z,{"current-page":s.listQuery.page,"page-size":s.listQuery.page_size,"page-sizes":[10,20,30,50],total:s.total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i.handleSizeChange,onCurrentChange:i.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])])}const G=Q(E,[["render",M]]);export{G as default};
