var b=(i,e,u)=>new Promise((V,t)=>{var m=n=>{try{d(u.next(n))}catch(c){t(c)}},f=n=>{try{d(u.throw(n))}catch(c){t(c)}},d=n=>n.done?V(n.value):Promise.resolve(n.value).then(m,f);d((u=u.apply(i,e)).next())});import{m as N}from"./mavon-editor-CA3v6ItN.js";/* empty css              */import{_ as j,D as a,m as g,n as p,G as r,H as l,P as h,Q as s,K as C,L as x,S as y,aB as D,R as v,av as _,a7 as k}from"./index-BYxaA_Lm.js";const I={name:"resources",components:{mavonEditor:N.mavonEditor},data(){return{inputValue:"",submitting:!1,activeCollapse:[],docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],form:{name:"",app:"",cve:[],description:"",image:"",docker_type:void 0},rules:{name:[{required:!0,message:"请输入资源名称",trigger:"blur"}],app:[{required:!0,message:"请输入组件名称",trigger:"blur"}],docker_type:[{required:!0,message:"请选择加载类型",trigger:"change"}],image:[{required:!0,message:"请输入镜像名称",trigger:"blur"}]},markdownToolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,trash:!0,save:!0,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0}}},created(){const{query:i}=this.$route,e=i.id;e&&this.getItem(e)},methods:{getItem(i){return b(this,null,function*(){try{const u=(yield k.get(`/api/admin/vulnerability/${i}`)).data;this.form={id:i,app:u.app,cve:u.cve||[],name:u.name,description:u.description,image:u.image||"",docker_type:u.docker_type}}catch(e){_.error(e.message||"获取数据失败")}})},goBack(){this.$router.back()},handleSubmit(){return b(this,null,function*(){try{if(!(yield this.$refs.form.validate()))return;this.submitting=!0,this.form.id?(yield k.put(`/api/admin/vulnerability/${this.form.id}`,this.form),_({type:"success",message:"更新成功",duration:2e3})):(yield k.post("/api/admin/vulnerability",this.form),_({type:"success",message:"添加成功",duration:2e3})),this.$router.replace({name:"vulnerability.resource"})}catch(i){i!=="cancel"&&_.error(i.message||"提交失败")}finally{this.submitting=!1}})},removeTag(i){this.form.cve.splice(i,1)},addTags(){if(!this.inputValue){_.warning("请输入CVE编号");return}this.form.cve||(this.form.cve=[]),this.form.cve.includes(this.inputValue)?_.warning("该CVE编号已存在"):(this.form.cve.push(this.inputValue),this.inputValue="")}}},R={class:"main"},A={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},F={class:"flex justify-between w-full h-[60px] p-4 items-center"},G={class:"flex items-center"},H={class:"font-bold text-lg"},M={class:"px-4 pb-8"},P={class:"mb-6 form-section"},Q={class:"form-section"},J={class:"cve-form-item"},O={class:"cve-input-container"},W={key:0,class:"tag-container"},X={class:"mt-3 form-section"},Y={class:"markdown-container"},Z={class:"flex justify-center gap-4 mt-8"};function $(i,e,u,V,t,m){const f=a("el-button"),d=a("el-input"),n=a("el-form-item"),c=a("el-col"),w=a("el-row"),E=a("el-option"),B=a("el-select"),T=a("el-tag"),U=a("el-empty"),q=a("mavon-editor"),S=a("el-collapse-item"),z=a("el-collapse"),K=a("el-form");return p(),g("div",R,[r("div",A,[r("div",F,[r("div",G,[l(f,{icon:"ArrowLeft",link:"",onClick:m.goBack,class:"mr-2"},null,8,["onClick"]),r("p",H,h(t.form.id?"编辑漏洞资源":"新增漏洞资源"),1)])]),r("div",M,[l(K,{model:t.form,ref:"form",rules:t.rules,"label-width":"100px","label-position":"left",class:"max-w-[1000px]"},{default:s(()=>[e[11]||(e[11]=r("div",{class:"section-title mb-4"},[r("span",{class:"font-bold"},"基本信息")],-1)),r("div",P,[l(w,{gutter:20},{default:s(()=>[l(c,{span:12},{default:s(()=>[l(n,{label:"资源名称",prop:"name"},{default:s(()=>[l(d,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.form.name=o),placeholder:"请输入资源名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:12},{default:s(()=>[l(n,{label:"组件",prop:"app"},{default:s(()=>[l(d,{modelValue:t.form.app,"onUpdate:modelValue":e[1]||(e[1]=o=>t.form.app=o),placeholder:"请输入组件名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(w,{gutter:20},{default:s(()=>[l(c,{span:12},{default:s(()=>[l(n,{label:"加载类型",prop:"docker_type"},{default:s(()=>[l(B,{modelValue:t.form.docker_type,"onUpdate:modelValue":e[2]||(e[2]=o=>t.form.docker_type=o),placeholder:"请选择加载类型",class:"w-full"},{default:s(()=>[(p(!0),g(C,null,x(t.docker_type_list,o=>(p(),y(E,{key:o.id,label:o.label,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(c,{span:12},{default:s(()=>[l(n,{label:"镜像名称",prop:"image"},{default:s(()=>[l(d,{modelValue:t.form.image,"onUpdate:modelValue":e[3]||(e[3]=o=>t.form.image=o),placeholder:"请输入镜像名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),e[12]||(e[12]=r("div",{class:"section-title mb-4"},[r("span",{class:"font-bold"},"漏洞类型")],-1)),r("div",Q,[r("div",J,[e[8]||(e[8]=r("label",{class:"cve-label"},"CVE",-1)),r("div",O,[l(d,{modelValue:t.inputValue,"onUpdate:modelValue":e[4]||(e[4]=o=>t.inputValue=o),placeholder:"请输入CVE编号",onKeyup:D(m.addTags,["enter"])},null,8,["modelValue","onKeyup"]),l(f,{type:"primary",onClick:m.addTags},{default:s(()=>[...e[7]||(e[7]=[v("添加",-1)])]),_:1},8,["onClick"])]),t.form.cve&&t.form.cve.length>0?(p(),g("div",W,[(p(!0),g(C,null,x(t.form.cve,(o,L)=>(p(),y(T,{size:"large",key:o,closable:"",onClose:ee=>m.removeTag(L)},{default:s(()=>[v(h(o),1)]),_:2},1032,["onClose"]))),128))])):(p(),y(U,{key:1,description:"暂无CVE信息","image-size":80,class:"mt-2"}))])]),l(z,{modelValue:t.activeCollapse,"onUpdate:modelValue":e[6]||(e[6]=o=>t.activeCollapse=o),class:"mb-6"},{default:s(()=>[l(S,{name:"description"},{title:s(()=>[...e[9]||(e[9]=[r("div",{class:"font-bold"},"漏洞描述",-1)])]),default:s(()=>[r("div",X,[l(n,{prop:"description",class:"mb-0"},{default:s(()=>[r("div",Y,[l(q,{modelValue:t.form.description,"onUpdate:modelValue":e[5]||(e[5]=o=>t.form.description=o),toolbars:t.markdownToolbars,boxShadow:!1,placeholder:"请输入漏洞详细描述信息",height:300},null,8,["modelValue","toolbars"])])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),r("div",Z,[l(f,{type:"primary",size:"large",onClick:m.handleSubmit,loading:t.submitting},{default:s(()=>[v(h(t.form.id?"保存修改":"提交"),1)]),_:1},8,["onClick","loading"]),l(f,{size:"large",onClick:m.goBack},{default:s(()=>[...e[10]||(e[10]=[v("取消",-1)])]),_:1},8,["onClick"])])]),_:1},8,["model","rules"])])])])}const re=j(I,[["render",$]]);export{re as default};
