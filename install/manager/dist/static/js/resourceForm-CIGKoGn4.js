var y=(_,o,r)=>new Promise((e,p)=>{var l=d=>{try{n(r.next(d))}catch(u){p(u)}},m=d=>{try{n(r.throw(d))}catch(u){p(u)}},n=d=>d.done?e(d.value):Promise.resolve(d.value).then(l,m);n((r=r.apply(_,o)).next())});import{_ as F,aV as q,r as f,e as D,z as w,o as T,D as c,S as k,n as g,Q as i,H as t,m as U,K as N,L as R,G as j,R as V,P as z,a7 as x,av as v}from"./index-pPDUazPi.js";const E={name:"resourceForm",components:{Box:q},props:{open:{type:Boolean,default:!1},data:{type:Object}},setup(_,{emit:o}){const r=f(null),e=f(!1),p=f([{label:"远程镜像",id:1},{label:"本地镜像",id:2}]),l=D({id:null,name:"",docker_type:null,image:null,description:null,resource_type:"CTF"}),m={name:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],docker_type:[{required:!0,message:"请选择加载类型",trigger:"change"}],image:[{required:!0,message:"请输入镜像名称",trigger:"blur"},{pattern:/^[a-zA-Z0-9\/_\-.:]+$/,message:"镜像名称格式不正确",trigger:"blur"}],description:[{min:0,max:200,message:"描述不能超过 200 个字符",trigger:"blur"}]},n=()=>{l.id=null,l.name="",l.docker_type=null,l.image=null,l.description=null,l.resource_type="CTF",r.value&&r.value.clearValidate()};w(()=>_.data,a=>{a&&Object.keys(a).length>0?(l.id=a.id,l.docker_type=a.docker_type,l.image=a.image,l.description=a.description,l.name=a.name,l.resource_type=a.resource_type||"CTF"):n()},{immediate:!0,deep:!0});const d=()=>{n(),o("action",!1)},u=()=>y(null,null,function*(){if(r.value)try{yield r.value.validate(),e.value=!0,l.id?(yield x.put(`/api/admin/docker/resource/${l.id}`,l),v({message:"更新成功",type:"success",duration:2e3})):(yield x.post("/api/admin/docker/resource",l),v({message:"添加成功",type:"success",duration:2e3})),n(),o("action",!0)}catch(a){if(a==="cancel")return;console.error("提交失败:",a)}finally{e.value=!1}});return T(()=>{}),{formRef:r,loading:e,docker_type_list:p,formData:l,rules:m,cancel:d,submit:u}}},L={class:"dialog-footer"};function M(_,o,r,e,p,l){const m=c("el-input"),n=c("el-form-item"),d=c("el-option"),u=c("el-select"),a=c("Box"),C=c("el-icon"),h=c("el-form"),b=c("el-button"),B=c("el-dialog");return g(),k(B,{modelValue:r.open,title:e.formData.id?"编辑资源":"添加资源",onClose:e.cancel,width:"600px","close-on-click-modal":!1},{footer:i(()=>[j("div",L,[t(b,{onClick:e.cancel,disabled:e.loading},{default:i(()=>[...o[4]||(o[4]=[V("取消",-1)])]),_:1},8,["onClick","disabled"]),t(b,{type:"primary",onClick:e.submit,loading:e.loading},{default:i(()=>[V(z(e.loading?"提交中...":"确定"),1)]),_:1},8,["onClick","loading"])])]),default:i(()=>[t(h,{model:e.formData,rules:e.rules,ref:"formRef","label-width":"100px","label-position":"right"},{default:i(()=>[t(n,{label:"资源名称",prop:"name",required:""},{default:i(()=>[t(m,{modelValue:e.formData.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formData.name=s),placeholder:"请输入资源名称",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{label:"加载类型",prop:"docker_type",required:""},{default:i(()=>[t(u,{modelValue:e.formData.docker_type,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formData.docker_type=s),placeholder:"请选择加载类型",style:{width:"100%"}},{default:i(()=>[(g(!0),U(N,null,R(e.docker_type_list,s=>(g(),k(d,{label:s.label,key:s.id,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"镜像名称",prop:"image",required:""},{default:i(()=>[t(m,{modelValue:e.formData.image,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formData.image=s),placeholder:"例如: nginx:latest 或 tongchengbin/easy_web",clearable:""},{prepend:i(()=>[t(C,null,{default:i(()=>[t(a)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"描述",prop:"description"},{default:i(()=>[t(m,{type:"textarea",modelValue:e.formData.description,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formData.description=s),rows:5,placeholder:"请输入资源描述信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])}const A=F(E,[["render",M],["__scopeId","data-v-6ae4d3a7"]]);export{A as default};
