var f=(a,e,s)=>new Promise((b,l)=>{var d=n=>{try{r(s.next(n))}catch(c){l(c)}},v=n=>{try{r(s.throw(n))}catch(c){l(c)}},r=n=>n.done?b(n.value):Promise.resolve(n.value).then(d,v);r((s=s.apply(a,e)).next())});import{_ as L,a8 as _,av as p,aw as T,q as B,H as t,R as i,G as h,E as D,U as S,D as u,a9 as E,p as x,S as w}from"./index-DGNIR5hM.js";const F={name:"index",data(){return{edit:!1,list:[],total:0,listLoading:!0,listQuery:{is_top:null,search:null,active:null,page:1,page_size:10},form:{id:null,isTop:!1,active:!0,content:""},rules:{content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]}}},created(){this.getList()},methods:{getList(){return f(this,null,function*(){this.listLoading=!0;try{const a=yield _.get("/api/admin/notice",this.listQuery),{data:e,total:s}=a;this.list=e,this.total=s}catch(a){p.error(a.message||"获取列表失败")}finally{this.listLoading=!1}})},changeTop(a,e){return f(this,null,function*(){try{yield _.put(`/api/admin/notice/${e.id}`,{isTop:a}),p({type:"success",message:"更新成功"})}catch(s){e.is_top=!a,p.error(s.message||"更新失败")}})},changeActive(a,e){return f(this,null,function*(){try{yield _.put(`/api/admin/notice/${e.id}`,{active:a}),p({type:"success",message:"更新成功"})}catch(s){e.active=!a,p.error(s.message||"更新失败")}})},handleDelete(a){return f(this,null,function*(){try{yield T.confirm("确认要删除该公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield _.delete(`/api/admin/notice/${a.id}`),p({type:"success",message:"删除成功"}),this.getList()}catch(e){e!=="cancel"&&p.error(e.message||"删除失败")}})},handleSizeChange(a){this.listQuery.page_size=a,this.getList()},handleCurrentChange(a){this.listQuery.page=a,this.getList()},handleFilter(){this.listQuery.page=1,this.getList()},handleCreate(){this.form={id:null,isTop:!1,active:!0,content:""},this.edit=!0},actionForm(){return f(this,null,function*(){try{yield this.$refs.formRef.validate(),this.form.id?yield _.put(`/api/admin/notice/${this.form.id}`,this.form):yield _.post("/api/admin/notice",this.form),p({type:"success",message:"保存成功"}),this.edit=!1,this.getList()}catch(a){a!=="cancel"&&p.error(a.message||"保存失败")}})}}},j={class:"main"},N={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},R={class:"flex justify-end mt-4"},q={class:"dialog-footer"};function A(a,e,s,b,l,d){const v=u("el-input"),r=u("el-form-item"),n=u("el-option"),c=u("el-select"),y=u("el-button"),C=u("el-form"),g=u("el-table-column"),V=u("el-switch"),k=u("el-table"),Q=u("el-pagination"),U=u("el-dialog"),z=E("loading");return x(),B("div",j,[t(C,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0,model:l.listQuery},{default:i(()=>[t(r,null,{default:i(()=>[t(v,{modelValue:l.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=o=>l.listQuery.search=o),placeholder:"请输入公告内容",class:"w-[200px]",clearable:""},null,8,["modelValue"])]),_:1}),t(r,null,{default:i(()=>[t(c,{modelValue:l.listQuery.active,"onUpdate:modelValue":e[1]||(e[1]=o=>l.listQuery.active=o),placeholder:"是否启用",clearable:"",style:{width:"120px"}},{default:i(()=>[t(n,{key:"1",label:"启用",value:"1"}),t(n,{key:"0",label:"未启用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:i(()=>[t(c,{modelValue:l.listQuery.is_top,"onUpdate:modelValue":e[2]||(e[2]=o=>l.listQuery.is_top=o),placeholder:"是否置顶",clearable:"",style:{width:"120px"}},{default:i(()=>[t(n,{key:"1",label:"是",value:"1"}),t(n,{key:"0",label:"否",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:i(()=>[t(y,{type:"primary",onClick:d.handleFilter},{default:i(()=>e[10]||(e[10]=[w("查询")])),_:1},8,["onClick"]),t(y,{type:"success",onClick:d.handleCreate},{default:i(()=>e[11]||(e[11]=[w("添加")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),h("div",N,[e[13]||(e[13]=h("div",{class:"flex justify-between w-full page-title"},[h("p",{class:"font-bold truncate"},"公告列表")],-1)),h("div",null,[D((x(),S(k,{data:l.list,fit:"","highlight-current-row":"",stripe:""},{default:i(()=>[t(g,{align:"center",label:"ID",width:"70",prop:"id"}),t(g,{label:"内容",align:"center",prop:"content"}),t(g,{label:"是否显示",width:"80",align:"center"},{default:i(o=>[t(V,{modelValue:o.row.active,"onUpdate:modelValue":m=>o.row.active=m,onChange:m=>d.changeActive(m,o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(g,{label:"是否置顶",width:"80",align:"center"},{default:i(o=>[t(V,{modelValue:o.row.is_top,"onUpdate:modelValue":m=>o.row.is_top=m,onChange:m=>d.changeTop(m,o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(g,{align:"center",label:"发布日期",prop:"date_created"}),t(g,{label:"操作",width:"120",align:"center"},{default:i(o=>[t(y,{type:"danger",link:"",onClick:m=>d.handleDelete(o.row)},{default:i(()=>e[12]||(e[12]=[w(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,l.listLoading]]),h("div",R,[t(Q,{"current-page":l.listQuery.page,"onUpdate:currentPage":e[3]||(e[3]=o=>l.listQuery.page=o),"page-size":l.listQuery.page_size,"onUpdate:pageSize":e[4]||(e[4]=o=>l.listQuery.page_size=o),"page-sizes":[10,20,30,50],total:l.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),t(U,{modelValue:l.edit,"onUpdate:modelValue":e[9]||(e[9]=o=>l.edit=o),title:l.form.id?"编辑公告":"添加公告",width:"500px",center:"","destroy-on-close":""},{footer:i(()=>[h("div",q,[t(y,{onClick:e[8]||(e[8]=o=>l.edit=!1)},{default:i(()=>e[14]||(e[14]=[w("取消")])),_:1}),t(y,{type:"primary",onClick:d.actionForm},{default:i(()=>e[15]||(e[15]=[w("确定")])),_:1},8,["onClick"])])]),default:i(()=>[t(C,{ref:"formRef",model:l.form,rules:l.rules,"label-width":"80px"},{default:i(()=>[t(r,{label:"是否公开",prop:"active"},{default:i(()=>[t(V,{modelValue:l.form.active,"onUpdate:modelValue":e[5]||(e[5]=o=>l.form.active=o)},null,8,["modelValue"])]),_:1}),t(r,{label:"是否置顶",prop:"isTop"},{default:i(()=>[t(V,{modelValue:l.form.isTop,"onUpdate:modelValue":e[6]||(e[6]=o=>l.form.isTop=o)},null,8,["modelValue"])]),_:1}),t(r,{label:"内容",prop:"content"},{default:i(()=>[t(v,{modelValue:l.form.content,"onUpdate:modelValue":e[7]||(e[7]=o=>l.form.content=o),type:"textarea",rows:"4",placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const H=L(F,[["render",A]]);export{H as default};
