var j=Object.defineProperty;var L=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var D=(s,e,n)=>e in s?j(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,z=(s,e)=>{for(var n in e||(e={}))M.call(e,n)&&D(s,n,e[n]);if(L)for(var n of L(e))G.call(e,n)&&D(s,n,e[n]);return s};var b=(s,e,n)=>new Promise((w,o)=>{var d=a=>{try{u(n.next(a))}catch(g){o(g)}},m=a=>{try{u(n.throw(a))}catch(g){o(g)}},u=a=>a.done?w(a.value):Promise.resolve(a.value).then(d,m);u((n=n.apply(s,e)).next())});import{_ as H,a8 as h,av as f,aw as J,q as k,H as l,R as i,G as _,E as K,U as C,D as r,a9 as P,p as y,S as p,P as S,J as U,K as B}from"./index-DGNIR5hM.js";import R from"./docker_resource_sync-DMfPZGtA.js";const A={name:"compose_db",components:{docker_resource_sync:R},data(){return{loading_build:!1,syncDialog:!1,docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],resource_type_list:[{label:"CTF",id:"CTF"},{label:"VUL",id:"VUL"}],form:{resource_type:"CTF",docker_type:1},centerDialogVisible:!1,listQuery:{page:1,page_size:10,search:""},listLoading:!1,list:[],total:0}},created(){this.getList()},methods:{getList(){this.listLoading=!0,h.get("/api/admin/docker/resource",this.listQuery).then(s=>{const{data:e,total:n}=s;this.list=e,this.total=n,this.listLoading=!1}).catch(()=>{this.listLoading=!1})},handleCreate(){this.form={resource_type:"CTF",docker_type:1},this.centerDialogVisible=!0},handleEdit(s){this.form=z({},s),this.centerDialogVisible=!0},handleBuild(s){this.loading_build=!0,h.post(`/api/admin/docker/resource/${s}/build`).then(()=>{f({type:"success",message:"任务提交成功",duration:2e3}),this.getList()}).finally(()=>{this.loading_build=!1})},handleDelete(s){return b(this,null,function*(){try{yield J.confirm("确认要删除该资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield h.delete(`/api/admin/docker/resource/${s}`),f({type:"success",message:"删除成功",duration:2e3}),this.getList()}catch(e){e!=="cancel"&&f.error("删除失败")}})},handleSubmit(){return b(this,null,function*(){try{this.form.id?(yield h.put(`/api/admin/docker/resource/${this.form.id}`,this.form),f({type:"success",message:"修改成功",duration:2e3})):(yield h.post("/api/admin/docker/resource",this.form),f({type:"success",message:"添加成功",duration:2e3})),this.form={resource_type:"CTF",docker_type:1},this.centerDialogVisible=!1,this.getList()}catch(s){f.error(s.message||"操作失败")}})},handleSizeChange(s){this.listQuery.page_size=s,this.getList()},handleCurrentChange(s){this.listQuery.page=s,this.getList()},handleSyncClose(){this.syncDialog=!1,this.getList()}}},I={class:"main"},O={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},W={class:"page-r"},X={class:"dialog-footer"};function Y(s,e,n,w,o,d){const m=r("el-input"),u=r("el-form-item"),a=r("el-button"),g=r("el-form"),c=r("el-table-column"),Q=r("el-tag"),T=r("el-table"),E=r("el-pagination"),V=r("el-option"),v=r("el-select"),F=r("el-dialog"),q=r("docker_resource_sync"),N=P("loading");return y(),k("div",I,[l(g,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:i(()=>[l(u,{class:"el-form-item"},{default:i(()=>[l(m,{modelValue:o.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=t=>o.listQuery.search=t),placeholder:"请输入名称",class:"w-[200px]"},null,8,["modelValue"])]),_:1}),l(u,null,{default:i(()=>[l(a,{type:"primary",onClick:e[1]||(e[1]=t=>d.getList())},{default:i(()=>e[9]||(e[9]=[p("查询")])),_:1}),l(a,{type:"success",onClick:d.handleCreate},{default:i(()=>e[10]||(e[10]=[p("添加")])),_:1},8,["onClick"])]),_:1})]),_:1}),_("div",O,[e[13]||(e[13]=_("div",{class:"flex justify-between w-full h-[60px] p-4"},[_("p",{class:"font-bold truncate"},"资源中心")],-1)),_("div",null,[K((y(),C(T,{fit:"","highlight-current-row":"",stripe:"",data:o.list},{default:i(()=>[l(c,{label:"名称",prop:"name",align:"center","class-name":"fnt-12"}),l(c,{label:"镜像",prop:"image",width:"250",align:"center","class-name":"fnt-12"}),l(c,{label:"资源类型",prop:"resource_type",width:"150",align:"center","class-name":"fnt-12"}),l(c,{label:"加载类型",prop:"docker_type_name",width:"150",align:"center","class-name":"fnt-12"}),l(c,{label:"开放端口",prop:"ports",width:"150",align:"center","class-name":"fnt-12"}),l(c,{label:"描述",prop:"description",width:"150","show-overflow-tooltip":"",align:"center","class-name":"fnt-12"}),l(c,{width:"120",align:"center",label:"状态"},{default:i(t=>[l(Q,{type:t.row.status===1?"success":t.row.status===2?"danger":"info"},{default:i(()=>[p(S(t.row.status===0?"初始化":t.row.status===1?"已编译":"编译失败"),1)]),_:2},1032,["type"])]),_:1}),l(c,{align:"center",label:"操作",width:"200"},{default:i(t=>[l(a,{link:"",type:"primary",onClick:x=>d.handleEdit(t.row)},{default:i(()=>e[11]||(e[11]=[p("编辑")])),_:2},1032,["onClick"]),l(a,{link:"",loading:o.loading_build,type:"primary",onClick:x=>d.handleBuild(t.row.id)},{default:i(()=>[p(S(t.row.status===0?"编译":"重新编译"),1)]),_:2},1032,["loading","onClick"]),l(a,{link:"",type:"danger",onClick:x=>d.handleDelete(t.row.id)},{default:i(()=>e[12]||(e[12]=[p("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,o.listLoading]]),_("div",W,[l(E,{background:"","current-page":o.listQuery.page,"page-sizes":[10,20,30,50],"page-size":o.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),l(F,{modelValue:o.centerDialogVisible,"onUpdate:modelValue":e[8]||(e[8]=t=>o.centerDialogVisible=t),title:"添加资源",width:"500px"},{footer:i(()=>[_("span",X,[l(a,{onClick:e[7]||(e[7]=t=>o.centerDialogVisible=!1)},{default:i(()=>e[14]||(e[14]=[p("取 消")])),_:1}),l(a,{type:"primary",onClick:d.handleSubmit},{default:i(()=>e[15]||(e[15]=[p("确 定")])),_:1},8,["onClick"])])]),default:i(()=>[l(g,{"label-width":"100px"},{default:i(()=>[l(u,{label:"资源名称",required:""},{default:i(()=>[l(m,{modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.name=t),placeholder:"请输入资源名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"资源类型",required:""},{default:i(()=>[l(v,{modelValue:o.form.resource_type,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.resource_type=t),filterable:"",class:"w-full"},{default:i(()=>[(y(!0),k(U,null,B(o.resource_type_list,t=>(y(),C(V,{label:t.label,key:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"加载类型",required:""},{default:i(()=>[l(v,{modelValue:o.form.docker_type,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.docker_type=t),filterable:"",class:"w-full"},{default:i(()=>[(y(!0),k(U,null,B(o.docker_type_list,t=>(y(),C(V,{label:t.label,key:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"镜像名称",required:""},{default:i(()=>[l(m,{modelValue:o.form.image,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.image=t),placeholder:"请输入镜像名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"描述"},{default:i(()=>[l(m,{modelValue:o.form.description,"onUpdate:modelValue":e[6]||(e[6]=t=>o.form.description=t),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(q,{onClose:d.handleSyncClose,open:o.syncDialog},null,8,["onClose","open"])])}const le=H(A,[["render",Y]]);export{le as default};
