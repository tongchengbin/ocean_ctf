import{_ as B,a7 as p,av as u,D as s,S as b,E as C,n as d,Q as t,H as o,G as a,m as k,K as w,L as E,R as f,P as S}from"./index-pPDUazPi.js";import{a as U}from"./index-CZTWs2AU.js";const L={components:{mavonEditor:U.mavonEditor},name:"addQuestion",props:{show:{type:Boolean},data:{type:Object}},data(){return{docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],resource_list:[],hostOption:[],imageOption:[],capture:null,fileChange:!1,options:[],cveInput:"",markdownToolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,trash:!0,save:!0,navigation:!0},attachment:[],form:{attachment:[],docker_type:null,image:null,name:null,description:null,cve:[]},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],docker_type:[{required:!0,message:"请选择加载类型",trigger:"change"}],image:[{required:!0,message:"请输入镜像名称",trigger:"blur"}],description:[{required:!0,message:"请填写描述信息",trigger:"blur"}]}}},created(){this.getOptions(),this.getResourceList(),this.data&&this.data.id&&(this.form=JSON.parse(JSON.stringify(this.data)),this.form.cve||(this.form.cve=[]))},methods:{getOptions(){p.get("/api/admin/ctf/question/type").then(n=>{this.options=n.data})},getResourceList(){p.get("/api/admin/docker/resource",{page_size:99999,status:1}).then(n=>{this.resource_list=n.data})},addCve(){if(!this.cveInput){u.warning("请输入CVE编号");return}this.form.cve||(this.form.cve=[]),this.form.cve.includes(this.cveInput)?u.warning("该CVE编号已存在"):(this.form.cve.push(this.cveInput),this.cveInput="")},removeCve(n){this.form.cve.splice(n,1)},cancel(){this.$emit("action",!1)},submit(){this.$refs.form.validate(n=>{if(!n)return!1;this.form.id?p.put(`/api/admin/vulnerability/${this.form.id}`,this.form).then(e=>{this.$emit("action",!0),u({message:"更新成功",type:"success"})}).catch(e=>{u.error(e.message||"更新失败")}):p.post("/api/admin/vulnerability",this.form).then(e=>{this.$emit("action",!0),u({message:"提交成功",type:"success"})}).catch(e=>{u.error(e.message||"提交失败")})})}}},R={class:"cve-form-item"},T={class:"cve-input-container"},D={key:0,class:"tag-container"},J={class:"markdown-container"},Q={slot:"footer",class:"dialog-footer"};function j(n,e,y,F,l,i){const _=s("el-input"),m=s("el-form-item"),c=s("el-col"),I=s("el-option"),x=s("el-select"),h=s("el-row"),v=s("el-card"),g=s("el-button"),O=s("el-tag"),q=s("mavon-editor"),N=s("el-form"),z=s("el-dialog");return y.show?(d(),b(z,{key:0,"before-close":i.cancel,"show-close":!0,title:l.form.id?"编辑资源":"添加资源",visible:y.show,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:i.cancel,width:"50%"},{default:t(()=>[o(N,{model:l.form,ref:"form",class:"form","label-width":"100px",rules:l.rules},{default:t(()=>[o(v,{class:"mb-4",shadow:"hover"},{header:t(()=>[...e[5]||(e[5]=[a("div",{class:"card-header"},[a("span",{class:"font-bold"},"基本信息")],-1)])]),default:t(()=>[o(h,{gutter:20},{default:t(()=>[o(c,{span:12},{default:t(()=>[o(m,{label:"资源名称",prop:"name"},{default:t(()=>[o(_,{modelValue:l.form.name,"onUpdate:modelValue":e[0]||(e[0]=r=>l.form.name=r),placeholder:"请输入资源名称",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),o(c,{span:12},{default:t(()=>[o(m,{label:"加载类型",prop:"docker_type"},{default:t(()=>[o(x,{modelValue:l.form.docker_type,"onUpdate:modelValue":e[1]||(e[1]=r=>l.form.docker_type=r),placeholder:"请选择加载类型",class:"w-full",size:"small"},{default:t(()=>[(d(!0),k(w,null,E(l.docker_type_list,r=>(d(),b(I,{label:r.label,key:r.id,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(h,{gutter:20},{default:t(()=>[o(c,{span:24},{default:t(()=>[o(m,{label:"镜像名称",prop:"image"},{default:t(()=>[o(_,{modelValue:l.form.image,"onUpdate:modelValue":e[2]||(e[2]=r=>l.form.image=r),placeholder:"请输入镜像名称",size:"small"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(v,{class:"mb-4",shadow:"hover"},{header:t(()=>[...e[6]||(e[6]=[a("div",{class:"card-header"},[a("span",{class:"font-bold"},"漏洞类型")],-1)])]),default:t(()=>[o(h,{gutter:20},{default:t(()=>[o(c,{span:24},{default:t(()=>[a("div",R,[e[8]||(e[8]=a("label",{class:"cve-label"},"CVE",-1)),a("div",T,[o(_,{modelValue:l.cveInput,"onUpdate:modelValue":e[3]||(e[3]=r=>l.cveInput=r),placeholder:"请输入CVE编号"},null,8,["modelValue"]),o(g,{type:"primary",onClick:i.addCve},{default:t(()=>[...e[7]||(e[7]=[f("添加",-1)])]),_:1},8,["onClick"])]),l.form.cve&&l.form.cve.length>0?(d(),k("div",D,[(d(!0),k(w,null,E(l.form.cve,(r,V)=>(d(),b(O,{key:V,closable:"",size:"large",onClose:G=>i.removeCve(V)},{default:t(()=>[f(S(r),1)]),_:2},1032,["onClose"]))),128))])):C("",!0)])]),_:1})]),_:1})]),_:1}),o(v,{shadow:"hover"},{header:t(()=>[...e[9]||(e[9]=[a("div",{class:"card-header"},[a("span",{class:"font-bold"},"漏洞描述")],-1)])]),default:t(()=>[o(m,{prop:"description"},{default:t(()=>[a("div",J,[o(q,{modelValue:l.form.description,"onUpdate:modelValue":e[4]||(e[4]=r=>l.form.description=r),toolbars:l.markdownToolbars,boxShadow:!1,placeholder:"请输入漏洞描述信息"},null,8,["modelValue","toolbars"])])]),_:1})]),_:1})]),_:1},8,["model","rules"]),a("span",Q,[o(g,{onClick:i.cancel},{default:t(()=>[...e[10]||(e[10]=[f("取 消",-1)])]),_:1},8,["onClick"]),o(g,{type:"primary",onClick:i.submit},{default:t(()=>[...e[11]||(e[11]=[f("确 定",-1)])]),_:1},8,["onClick"])])]),_:1},8,["before-close","title","visible","onClose"])):C("",!0)}const M=B(L,[["render",j],["__scopeId","data-v-5a28cb1b"]]);export{M as default};
