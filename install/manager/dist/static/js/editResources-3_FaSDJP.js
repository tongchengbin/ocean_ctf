var b=(a,e,s)=>new Promise((k,t)=>{var m=n=>{try{i(s.next(n))}catch(c){t(c)}},p=n=>{try{i(s.throw(n))}catch(c){t(c)}},i=n=>n.done?k(n.value):Promise.resolve(n.value).then(m,p);i((s=s.apply(a,e)).next())});import{m as B}from"./mavon-editor-CBDuhmni.js";/* empty css              */import{_ as K,a8 as v,av as h,q as y,G as u,P as V,H as r,R as o,D as d,p as f,J as w,K as x,U as C,S as _,aA as S}from"./index-DGNIR5hM.js";const N={name:"resources",components:{mavonEditor:B.mavonEditor},data(){return{inputValue:"",docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],form:{name:"",app:"",cve:[],description:"",image:"",docker_type:void 0},rules:{name:[{required:!0,message:"请输入资源名称",trigger:"blur"}],app:[{required:!0,message:"请输入组件名称",trigger:"blur"}],docker_type:[{required:!0,message:"请选择加载类型",trigger:"change"}],image:[{required:!0,message:"请输入镜像名称",trigger:"blur"}]},markdownToolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,trash:!0,save:!0,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0}}},created(){const{query:a}=this.$route,e=a.id;e&&this.getItem(e)},methods:{getItem(a){return b(this,null,function*(){try{const s=(yield v.get(`/api/admin/vulnerability/${a}`)).data;this.form={id:a,app:s.app,cve:s.cve||[],name:s.name,description:s.description,image:s.image||"",docker_type:s.docker_type}}catch(e){h.error(e.message||"获取数据失败")}})},goBack(){this.$router.back()},handleSubmit(){return b(this,null,function*(){try{yield this.$refs.form.validate(),this.form.id?yield v.put(`/api/admin/vulnerability/${this.form.id}`,this.form):yield v.post("/api/admin/vulnerability",this.form),h({type:"success",message:"提交成功",duration:2e3}),this.$router.replace({name:"vulnerability.resource"})}catch(a){a!=="cancel"&&h.error(a.message||"提交失败")}})},removeTag(a){this.form.cve.splice(a,1)},addTags(){this.inputValue&&!this.form.cve.includes(this.inputValue)&&(this.form.cve.push(this.inputValue),this.inputValue="")}}},j={class:"main"},D={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},I={class:"flex justify-between w-full h-[60px] p-4"},R={class:"font-bold truncate"},z={class:"px-4"},A={class:"flex flex-wrap gap-2 mb-2"},F={class:"flex gap-2"},G={class:"markdown-body"},H={class:"flex justify-center gap-4"};function J(a,e,s,k,t,m){const p=d("el-input"),i=d("el-form-item"),n=d("el-option"),c=d("el-select"),T=d("el-tag"),g=d("el-button"),q=d("mavon-editor"),E=d("el-form");return f(),y("div",j,[u("div",D,[u("div",I,[u("p",R,V(t.form.id?"编辑漏洞资源":"新增漏洞资源"),1)]),u("div",z,[r(E,{model:t.form,ref:"form",rules:t.rules,"label-width":"120px",class:"max-w-[800px] mx-auto"},{default:o(()=>[r(i,{label:"资源名称",prop:"name"},{default:o(()=>[r(p,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=l=>t.form.name=l),placeholder:"请输入资源名称"},null,8,["modelValue"])]),_:1}),r(i,{label:"组件",prop:"app"},{default:o(()=>[r(p,{modelValue:t.form.app,"onUpdate:modelValue":e[1]||(e[1]=l=>t.form.app=l),placeholder:"请输入组件名称"},null,8,["modelValue"])]),_:1}),r(i,{label:"加载类型",prop:"docker_type"},{default:o(()=>[r(c,{modelValue:t.form.docker_type,"onUpdate:modelValue":e[2]||(e[2]=l=>t.form.docker_type=l),placeholder:"请选择加载类型",class:"w-full"},{default:o(()=>[(f(!0),y(w,null,x(t.docker_type_list,l=>(f(),C(n,{key:l.id,label:l.label,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"CVE",prop:"cve"},{default:o(()=>[u("div",A,[(f(!0),y(w,null,x(t.form.cve,(l,U)=>(f(),C(T,{key:l,size:"small",closable:"",onClose:L=>m.removeTag(U)},{default:o(()=>[_(V(l),1)]),_:2},1032,["onClose"]))),128))]),u("div",F,[r(p,{modelValue:t.inputValue,"onUpdate:modelValue":e[3]||(e[3]=l=>t.inputValue=l),placeholder:"请输入CVE编号",onKeyup:S(m.addTags,["enter"])},null,8,["modelValue","onKeyup"]),r(g,{type:"primary",onClick:m.addTags},{default:o(()=>e[6]||(e[6]=[_("添加")])),_:1},8,["onClick"])])]),_:1}),r(i,{label:"镜像名称",prop:"image"},{default:o(()=>[r(p,{modelValue:t.form.image,"onUpdate:modelValue":e[4]||(e[4]=l=>t.form.image=l),placeholder:"请输入镜像名称"},null,8,["modelValue"])]),_:1}),r(i,{label:"描述",prop:"description"},{default:o(()=>[u("div",G,[r(q,{modelValue:t.form.description,"onUpdate:modelValue":e[5]||(e[5]=l=>t.form.description=l),toolbars:t.markdownToolbars,placeholder:"请输入资源描述"},null,8,["modelValue","toolbars"])])]),_:1}),r(i,null,{default:o(()=>[u("div",H,[r(g,{type:"primary",onClick:m.handleSubmit},{default:o(()=>e[7]||(e[7]=[_("提交")])),_:1},8,["onClick"]),r(g,{onClick:m.goBack},{default:o(()=>e[8]||(e[8]=[_("返回")])),_:1},8,["onClick"])])]),_:1})]),_:1},8,["model","rules"])])])])}const W=K(N,[["render",J]]);export{W as default};
