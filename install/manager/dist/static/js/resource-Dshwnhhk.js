var N=Object.defineProperty;var D=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var B=(i,e,r)=>e in i?N(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,x=(i,e)=>{for(var r in e||(e={}))j.call(e,r)&&B(i,r,e[r]);if(D)for(var r of D(e))G.call(e,r)&&B(i,r,e[r]);return i};var w=(i,e,r)=>new Promise((k,o)=>{var d=n=>{try{u(r.next(n))}catch(f){o(f)}},g=n=>{try{u(r.throw(n))}catch(f){o(f)}},u=n=>n.done?k(n.value):Promise.resolve(n.value).then(d,g);u((r=r.apply(i,e)).next())});import{_ as H,D as a,a9 as K,m as C,n as m,H as t,G as _,S as b,E as P,Q as s,R as c,F as R,P as z,K as U,L as Q,a7 as y,av as h,aw as A}from"./index-BYxaA_Lm.js";import J from"./docker_resource_sync-DNeo-4DV.js";import{B as O}from"./index-CR7Cr9n7.js";const W={name:"compose_db",components:{docker_resource_sync:J,BuildLogViewer:O},data(){return{loadingBuildMap:{},syncDialog:!1,showLogDialog:!1,currentBuildId:null,docker_type_list:[{label:"远程镜像",id:1},{label:"本地镜像",id:2}],resource_type_list:[{label:"CTF",id:"CTF"},{label:"VUL",id:"VUL"}],form:{resource_type:"CTF",docker_type:1},centerDialogVisible:!1,listQuery:{page:1,page_size:10,search:""},listLoading:!1,list:[],total:0}},created(){this.getList()},methods:{getList(){this.listLoading=!0,y.get("/api/admin/docker/resource",this.listQuery).then(i=>{const{data:e,total:r}=i;this.list=e,this.total=r,this.listLoading=!1}).catch(()=>{this.listLoading=!1})},handleCreate(){this.form={resource_type:"CTF",docker_type:1},this.centerDialogVisible=!0},handleEdit(i){this.form=x({},i),this.centerDialogVisible=!0},handleBuild(i){this.currentBuildId=i,this.loadingBuildMap[i]=!0,y.post(`/api/admin/docker/resource/${i}/build`).then(()=>{h({type:"success",message:"任务提交成功",duration:2e3}),this.showLogDialog=!0,this.getList()}).finally(()=>{this.loadingBuildMap[i]=!1})},handleDelete(i){return w(this,null,function*(){try{yield A.confirm("确认要删除该资源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield y.delete(`/api/admin/docker/resource/${i}`),h({type:"success",message:"删除成功",duration:2e3}),this.getList()}catch(e){e!=="cancel"&&h.error("删除失败")}})},handleSubmit(){return w(this,null,function*(){try{this.form.id?(yield y.put(`/api/admin/docker/resource/${this.form.id}`,this.form),h({type:"success",message:"修改成功",duration:2e3})):(yield y.post("/api/admin/docker/resource",this.form),h({type:"success",message:"添加成功",duration:2e3})),this.form={resource_type:"CTF",docker_type:1},this.centerDialogVisible=!1,this.getList()}catch(i){h.error(i.message||"操作失败")}})},handleSizeChange(i){this.listQuery.page_size=i,this.getList()},handleCurrentChange(i){this.listQuery.page=i,this.getList()},handleSyncClose(){this.syncDialog=!1,this.getList()},handleLogDialogClosed(){this.currentBuildId=null}}},X={class:"main"},Y={class:"w-[99/100] mt-2 px-2 pb-2 bg-bg_color"},Z={class:"page-r"},$={class:"dialog-footer"};function ee(i,e,r,k,o,d){const g=a("el-input"),u=a("el-form-item"),n=a("el-button"),f=a("el-form"),p=a("el-table-column"),S=a("el-tag"),T=a("el-table"),F=a("el-pagination"),V=a("el-option"),v=a("el-select"),E=a("el-dialog"),M=a("docker_resource_sync"),q=a("build-log-viewer"),I=K("loading");return m(),C("div",X,[t(f,{class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]",inline:!0},{default:s(()=>[t(u,{class:"el-form-item"},{default:s(()=>[t(g,{modelValue:o.listQuery.search,"onUpdate:modelValue":e[0]||(e[0]=l=>o.listQuery.search=l),placeholder:"请输入名称",class:"w-[200px]"},null,8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(n,{type:"primary",onClick:e[1]||(e[1]=l=>d.getList())},{default:s(()=>[...e[11]||(e[11]=[c("查询",-1)])]),_:1}),t(n,{type:"success",onClick:d.handleCreate},{default:s(()=>[...e[12]||(e[12]=[c("添加",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),_("div",Y,[e[15]||(e[15]=_("div",{class:"flex justify-between w-full h-[60px] p-4"},[_("p",{class:"font-bold truncate"},"资源中心")],-1)),_("div",null,[R((m(),b(T,{fit:"","highlight-current-row":"",stripe:"",data:o.list},{default:s(()=>[t(p,{label:"名称",prop:"name",align:"center","class-name":"fnt-12"}),t(p,{label:"镜像",prop:"image",width:"250",align:"center","class-name":"fnt-12"}),t(p,{label:"资源类型",prop:"resource_type",width:"150",align:"center","class-name":"fnt-12"}),t(p,{label:"加载类型",prop:"docker_type_name",width:"150",align:"center","class-name":"fnt-12"}),t(p,{label:"开放端口",prop:"ports",width:"150",align:"center","class-name":"fnt-12"}),t(p,{label:"描述",prop:"description",width:"150","show-overflow-tooltip":"",align:"center","class-name":"fnt-12"}),t(p,{width:"120",align:"center",label:"状态"},{default:s(l=>[t(S,{type:l.row.status===1?"success":l.row.status===2?"danger":"info"},{default:s(()=>[c(z(l.row.status===0?"初始化":l.row.status===1?"已编译":"编译失败"),1)]),_:2},1032,["type"])]),_:1}),t(p,{align:"center",label:"操作",width:"200"},{default:s(l=>[t(n,{link:"",type:"primary",onClick:L=>d.handleEdit(l.row)},{default:s(()=>[...e[13]||(e[13]=[c("编辑",-1)])]),_:1},8,["onClick"]),t(n,{link:"",loading:o.loadingBuildMap[l.row.id],type:"primary",onClick:L=>d.handleBuild(l.row.id)},{default:s(()=>[c(z(l.row.status===0?"编译":"重新编译"),1)]),_:2},1032,["loading","onClick"]),t(n,{link:"",type:"danger",onClick:L=>d.handleDelete(l.row.id)},{default:s(()=>[...e[14]||(e[14]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,o.listLoading]]),_("div",Z,[t(F,{background:"","current-page":o.listQuery.page,"page-sizes":[10,20,30,50],"page-size":o.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),t(E,{modelValue:o.centerDialogVisible,"onUpdate:modelValue":e[8]||(e[8]=l=>o.centerDialogVisible=l),title:"添加资源",width:"500px"},{default:s(()=>[t(f,{"label-width":"100px"},{footer:s(()=>[_("span",$,[t(n,{onClick:e[7]||(e[7]=l=>o.centerDialogVisible=!1)},{default:s(()=>[...e[16]||(e[16]=[c("取 消",-1)])]),_:1}),t(n,{type:"primary",onClick:d.handleSubmit},{default:s(()=>[...e[17]||(e[17]=[c("确 定",-1)])]),_:1},8,["onClick"])])]),default:s(()=>[t(u,{label:"资源名称",required:""},{default:s(()=>[t(g,{modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.name=l),placeholder:"请输入资源名称"},null,8,["modelValue"])]),_:1}),t(u,{label:"资源类型",required:""},{default:s(()=>[t(v,{modelValue:o.form.resource_type,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.resource_type=l),filterable:"",class:"w-full"},{default:s(()=>[(m(!0),C(U,null,Q(o.resource_type_list,l=>(m(),b(V,{label:l.label,key:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"加载类型",required:""},{default:s(()=>[t(v,{modelValue:o.form.docker_type,"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.docker_type=l),filterable:"",class:"w-full"},{default:s(()=>[(m(!0),C(U,null,Q(o.docker_type_list,l=>(m(),b(V,{label:l.label,key:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"镜像名称",required:""},{default:s(()=>[t(g,{modelValue:o.form.image,"onUpdate:modelValue":e[5]||(e[5]=l=>o.form.image=l),placeholder:"请输入镜像名称"},null,8,["modelValue"])]),_:1}),t(u,{label:"描述"},{default:s(()=>[t(g,{modelValue:o.form.description,"onUpdate:modelValue":e[6]||(e[6]=l=>o.form.description=l),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o.syncDialog?(m(),b(M,{key:0,onClose:e[9]||(e[9]=l=>o.syncDialog=!1)})):P("",!0),t(q,{modelValue:o.showLogDialog,"onUpdate:modelValue":e[10]||(e[10]=l=>o.showLogDialog=l),"resource-id":o.currentBuildId,title:"编译日志","loading-text":"正在编译中，请稍候...","api-path":"/api/admin/docker/resource/{id}/logs",onClosed:d.handleLogDialogClosed},null,8,["modelValue","resource-id","onClosed"])])}const se=H(W,[["render",ee]]);export{se as default};
